(this.webpackJsonpsplooshkaboom=this.webpackJsonpsplooshkaboom||[]).push([[0],{124:function(e,t,a){e.exports=a(401)},128:function(e,t,a){},129:function(e,t,a){},401:function(e,t,a){"use strict";a.r(t);var n,r=a(1),o=a.n(r),i=a(17),s=a.n(i),l=(a(128),a(2)),c=a.n(l),u=a(52),d=a(123),h=a(54),f=a(11),p=a(15),b=a(41),v=a(42),m=a(44),w=a(43),y=a(32),g=(a(129),a(130),null);var x=0;function k(e,t){var a=t(1*e.length);return(null!==g&&g.buffer===n.memory.buffer||(g=new Uint8Array(n.memory.buffer)),g).set(e,a/1),x=e.length,a}var S=null;function E(e,t){var a=t(4*e.length);return(null!==S&&S.buffer===n.memory.buffer||(S=new Uint32Array(n.memory.buffer)),S).set(e,a/4),x=e.length,a}var _=null;function C(){return null!==_&&_.buffer===n.memory.buffer||(_=new Float64Array(n.memory.buffer)),_}function M(e,t){var a=t(8*e.length);return C().set(e,a/8),x=e.length,a}var O=null;function B(){return null!==O&&O.buffer===n.memory.buffer||(O=new Int32Array(n.memory.buffer)),O}function R(e,t){return C().subarray(e/8,e/8+t)}function T(e,t,a,r,o){var i=k(e,n.__wbindgen_malloc),s=x,l=k(t,n.__wbindgen_malloc),c=x,u=E(r,n.__wbindgen_malloc),d=x,h=M(o,n.__wbindgen_malloc),f=x;n.calculate_probabilities_with_board_constraints(8,i,s,l,c,a,u,d,h,f);var p,b=B()[2],v=B()[3];return 0!==b&&(p=R(b,v).slice(),n.__wbindgen_free(b,8*v)),p}function P(e,t,a,r,o,i){var s=k(e,n.__wbindgen_malloc),l=x,c=k(t,n.__wbindgen_malloc),u=x,d=E(r,n.__wbindgen_malloc),h=x,f=E(o,n.__wbindgen_malloc),p=x,b=M(i,n.__wbindgen_malloc),v=x;n.calculate_probabilities_from_game_history(8,s,l,c,u,a,d,h,f,p,b,v);var m,w=B()[2],y=B()[3];return 0!==w&&(m=R(w,y).slice(),n.__wbindgen_free(w,8*y)),m}function F(e,t){return A.apply(this,arguments)}function A(){return(A=Object(p.a)(c.a.mark((function e(t,a){var n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("function"===typeof Response&&t instanceof Response)){e.next=23;break}if("function"!==typeof WebAssembly.instantiateStreaming){e.next=15;break}return e.prev=2,e.next=5,WebAssembly.instantiateStreaming(t,a);case 5:return e.abrupt("return",e.sent);case 8:if(e.prev=8,e.t0=e.catch(2),"application/wasm"==t.headers.get("Content-Type")){e.next=14;break}console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",e.t0),e.next=15;break;case 14:throw e.t0;case 15:return e.next=17,t.arrayBuffer();case 17:return n=e.sent,e.next=20,WebAssembly.instantiate(n,a);case 20:return e.abrupt("return",e.sent);case 23:return e.next=25,WebAssembly.instantiate(t,a);case 25:if(!((r=e.sent)instanceof WebAssembly.Instance)){e.next=30;break}return e.abrupt("return",{instance:r,module:t});case 30:return e.abrupt("return",r);case 31:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function I(e){return j.apply(this,arguments)}function j(){return(j=Object(p.a)(c.a.mark((function e(t){var a,r,o,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={},("string"===typeof t||"function"===typeof Request&&t instanceof Request||"function"===typeof URL&&t instanceof URL)&&(t=fetch(t)),e.t0=F,e.next=5,t;case 5:return e.t1=e.sent,e.t2=a,e.next=9,(0,e.t0)(e.t1,e.t2);case 9:return r=e.sent,o=r.instance,i=r.module,n=o.exports,I.__wbindgen_wasm_module=i,e.abrupt("return",n);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var q=I,z=(a(131),a(388),a(392)(["#004","#070","#090","#0b0","#0d0","#0f0","#6f6"])),L=function(e){return Object(y.a)(Array(e).keys())},G=function(e){Object(m.a)(a,e);var t=Object(w.a)(a);function a(){return Object(b.a)(this,a),t.apply(this,arguments)}return Object(v.a)(a,[{key:"render",value:function(){var e=null!==this.props.best&&this.props.best[0]==this.props.x&&this.props.best[1]==this.props.y,t=this.props.backgroundColor;return void 0===t&&(t=null===this.props.text?z(this.props.prob):"HIT"===this.props.text?"#a2a":"#44a"),o.a.createElement("div",{key:this.props.x+","+this.props.y,style:{display:"flex",justifyContent:"center",alignItems:"center",textAlign:"center",width:"70px",height:"70px",border:this.props.valid?"1px solid grey":"1px solid red",outline:e?"4px solid yellow":"",zIndex:e?1:0,fontFamily:"monospace",userSelect:"none",MozUserSelect:"none",WebkitUserSelect:"none",msUserSelect:"none",color:"white",fontSize:this.props.fontSize,opacity:this.props.opacity,backgroundColor:t},onClick:this.props.onClick},null===this.props.text?(100*this.props.prob).toFixed(this.props.precision)+"%":this.props.text)}}]),a}(o.a.Component),N=q("/web-sploosh-kaboom/sploosh_wasm_bg.wasm");window.JUST_ONCE=!1;var U=null;function D(){return V.apply(this,arguments)}function V(){return(V=Object(p.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==U){e.next=2;break}return e.abrupt("return");case 2:if(!U.readyToProcess()||!U.state.doVideoProcessing){e.next=5;break}return e.next=5,U.readBoardState();case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(){return W.apply(this,arguments)}function W(){return(W=Object(p.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D();case 2:setTimeout(H,25);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(){return function(){for(var e=[],t=0;t<8;t++)for(var a=0;a<8;a++)for(var n=0,r=[!1,!0];n<r.length;n++){var o=r[n];e.push({x:a,y:t,direction:o})}var i=[],s={};function l(e,t,a){for(var n=0;n<a;n++){var r=t.x,o=t.y;if(t.direction?r+=n:o+=n,r>=8||o>=8)return;e[r+8*o]=a}}for(var c=new Array(64).fill(0),u=0,d=e;u<d.length;u++){var h,p=d[u],b=Object(f.a)(e);try{for(b.s();!(h=b.n()).done;){var v,m=h.value,w=Object(f.a)(e);try{for(w.s();!(v=w.n()).done;){var y=v.value;c.fill(0),l(c,p,2),l(c,m,3),l(c,y,4);var g,x=0,k=Object(f.a)(c);try{for(k.s();!(g=k.n()).done;){var S=g.value;x+=S}}catch(O){k.e(O)}finally{k.f()}29===x&&i.push(Array.from(c))}}catch(O){w.e(O)}finally{w.f()}}}catch(O){b.e(O)}finally{b.f()}}for(var E=0,_=0,C=i;_<C.length;_++){var M=C[_];s[M.map((function(e){return 0===e?".":e})).join("")]=E,E++}return s}()}function X(e){for(var t=Math.round(8*Math.random()),a=Math.round(8*Math.random()),n=Math.random()<.5,r=[[t,a]],o=0;o<e-1;o++){var i=r[r.length-1],s=n?[i[0]+1,i[1]]:[i[0],i[1]+1];r.push(s)}return r}window.JUST_ONCE||H();var J=function(e){Object(m.a)(a,e);var t=Object(w.a)(a);function a(){var e;Object(b.a)(this,a),e=t.call(this);for(var n=[],r=0;r<8;r++)for(var o=0;o<8;o++)n[[o,r]]=".";return e.state={grid:n,selectedCell:null},e}return Object(v.a)(a,[{key:"onClick",value:function(e,t){if(null!==this.state.selectedCell){for(var a=Object(h.a)({},this.state.grid),n=!1,r=0,o=[2,3,4];r<o.length;r++)for(var i=o[r],s=0,l=[[1,0],[0,1],[-1,0],[0,-1]];s<l.length;s++){var c=Object(d.a)(l[s],2),u=c[0],f=c[1];if(this.state.selectedCell[0]===e+u*(i-1)&&this.state.selectedCell[1]===t+f*(i-1)){for(var p=0;p<8;p++)for(var b=0;b<8;b++)a[[b,p]]===""+i&&(a[[b,p]]=".");for(var v=0;v<i;v++)a[[e+v*u,t+v*f]]=""+i;n=!0}}for(var m={2:0,3:0,4:0,".":0},w=0;w<8;w++)for(var y=0;y<8;y++)m[a[[y,w]]]++;for(var g=0,x=[2,3,4];g<x.length;g++){var k=x[g];if(m[k]!==k)for(var S=0;S<8;S++)for(var E=0;E<8;E++)a[[E,S]]===""+k&&(a[[E,S]]=".")}n&&this.setState({grid:a}),this.setState({selectedCell:null})}else this.setState({selectedCell:[e,t]})}},{key:"getLayoutString",value:function(){for(var e="",t=0;t<8;t++)for(var a=0;a<8;a++)e+=this.state.grid[[a,t]];return e}},{key:"render",value:function(){var e=this,t=this.getLayoutString(),a=this.props.parent.boardIndices[t],n=function(t,a){return null!==e.state.selectedCell&&t===e.state.selectedCell[0]&&a===e.state.selectedCell[1]};return o.a.createElement("div",{style:{margin:"20px",display:"inline-block",color:"white"}},o.a.createElement("div",{style:{backgroundImage:'url("/web-sploosh-kaboom/board_background_square.png")',backgroundSize:"100% 100%",padding:"18px"}},L(8).map((function(t){return o.a.createElement("div",{key:t,style:{display:"flex"}},L(8).map((function(a){return o.a.createElement(G,{key:a+","+t,x:a,y:t,onClick:function(){return e.onClick(a,t)},text:e.state.grid[[a,t]],valid:!0,best:e.state.selectedCell,fontSize:"200%",opacity:n(a,t)||"."!==e.state.grid[[a,t]]?.6:.2})})))}))),o.a.createElement("br",null),"Squid Layout: ",a)}}]),a}(o.a.Component),K=function(e){Object(m.a)(a,e);var t=Object(w.a)(a);function a(){var e;return Object(b.a)(this,a),(e=t.call(this)).videoRef=o.a.createRef(),e.canvasRef=o.a.createRef(),e.outputCanvasRef=o.a.createRef(),e.hiddenAreaRef=o.a.createRef(),e.layoutDrawingBoardRefs=[o.a.createRef(),o.a.createRef(),o.a.createRef()],e.state=e.makeEmptyState(),e.bannerCache=new Map,e.doComputation(e.state.grid,e.state.squidsGotten),window.RECOMP=function(){e.bannerCache=new Map,e.getBoardRegistrationAndScale()},U=Object(u.a)(e),e.previouslyReadStates=[null,null,null],e}return Object(v.a)(a,[{key:"componentDidMount",value:function(){this.makeReferenceImageCanvases()}},{key:"makeReferenceImageCanvases",value:function(){var e=this,t=this.hiddenAreaRef.current;this.referenceCanvases={};for(var a=function(){var a=r[n],o=document.createElement("canvas");o.setAttribute("id","canvas_"+a),t.appendChild(o);var i=document.createElement("img");i.src="/web-sploosh-kaboom/images/"+a+".png",i.onload=function(){console.log("Width:",this.width,this.height,this),o.width=this.width,o.height=this.height,o.getContext("2d").drawImage(i,0,0)},e.referenceCanvases[a]=o},n=0,r=["hit","miss","killed_squid","remaining_squid","top_banner_new","bottom_banner_new"];n<r.length;n++)a()}},{key:"makeEmptyState",value:function(){for(var e=[],t=[],a=0;a<8;a++)for(var n=0;n<8;n++)e[[n,a]]=null,t[[n,a]]=0;return{mode:"calculator",squidLayout:function(){for(var e={},t={},a=0,n=[2,3,4];a<n.length;a++)for(var r=n[a];;){var o,i=X(r),s=!0,l=Object(f.a)(i);try{for(l.s();!(o=l.n()).done;){var c=o.value;(c[0]>7||c[1]>7||!0===t[c])&&(s=!1)}}catch(h){l.e(h)}finally{l.f()}if(s){e["squid"+r]=i;var u,d=Object(f.a)(i);try{for(d.s();!(u=d.n()).done;){t[u.value]=!0}}catch(h){d.e(h)}finally{d.f()}break}}return console.log("Generated:",e),e}(),grid:e,squidsGotten:"unknown",probs:t,best:[3,3],valid:!0,observationProb:1,screenRecordingActive:!1,doVideoProcessing:!1,lastComputationTime:-1,lastCVTime:-1,turboBlurboMode:!1,potentialMatches:[],firstBoardStepsThousands:100,firstBoardStepsThousandsStdDev:100,nextBoardStepsThousands:3,nextBoardStepsThousandsStdDev:1}}},{key:"startScreenRecording",value:function(){var e=Object(p.a)(c.a.mark((function e(){var t,a,n,r,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.state.screenRecordingActive){e.next=3;break}return alert("Already screen capturing!"),e.abrupt("return");case 3:return t={video:{cursor:"always"},audio:!1},e.next=6,navigator.mediaDevices.getDisplayMedia(t);case 6:return a=e.sent,(n=this.videoRef.current).srcObject=a,n.play(),this.setState({screenRecordingActive:!0}),e.next=13,new Promise((function(e){return setTimeout(e,500)}));case 13:this.updateCapture(),r=this.canvasRef.current,o=this.outputCanvasRef.current,console.log(r,o,r.width,r.height),o.width=r.width,o.height=r.height,o.getContext("2d").drawImage(r,0,0);case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initializeTurboBlurboMode",value:function(e){var t=this;if(!1===this.state.turboBlurboMode){this.setState({turboBlurboMode:"initializing"}),this.boardIndices=Y();var a=new XMLHttpRequest,r=e?"/board_table_25M.bin":"/board_table_5M.bin";a.open("GET","/web-sploosh-kaboom"+r,!0),a.responseType="arraybuffer",a.onload=function(e){t.boardTable=new Uint32Array(a.response),console.log("Board table length:",t.boardTable.length);var r,o=Object(f.a)(t.boardTable);try{for(o.s();!(r=o.n()).done;){var i=r.value;i>604583&&alert("BUG BUG BUG: Bad value in board table: "+i)}}catch(s){o.e(s)}finally{o.f()}!function(e){var t=E(e,n.__wbindgen_malloc),a=x;n.set_board_table(t,a)}(t.boardTable),t.setState({turboBlurboMode:!0})},a.send()}}},{key:"toggleVideoProcessing",value:function(){if(this.state.screenRecordingActive)if(!1!==this.state.doVideoProcessing||this.readyToProcess()){if(this.setState({doVideoProcessing:!this.state.doVideoProcessing}),null!==this.previouslyReadStates[this.previouslyReadStates.length-1]){var e=this.previouslyReadStates[this.previouslyReadStates.length-1];this.setState(e),this.doComputation(e.grid,e.squidsGotten),this.previouslyReadStates[this.previouslyReadStates.length-1]=null}}else alert("You must first detect a board.")}},{key:"getBoardRegistrationAndScale",value:function(){var e=Object(p.a)(c.a.mark((function e(){var t,a,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.screenRecordingActive){e.next=2;break}return e.abrupt("return");case 2:this.updateCapture(),t=.375,a=.7,n=0;case 6:if(!(n<10)){e.next=15;break}return e.next=9,this.performGridSearch(t*(1-a),t*(1+2*a),0==n?20:1==n?10:4);case 9:this.boardFitParams=e.sent,t=this.boardFitParams.scale,a/=2;case 12:n++,e.next=6;break;case 15:return console.log("Best fit params:",this.boardFitParams),this.bannerCache.delete(t),this.testForTopBannerAtScale(t),this.testForBottomBanner(),console.log("Final fit params:",this.boardFitParams),e.next=22,new Promise((function(e){return setTimeout(e,100)}));case 22:this.setState({doVideoProcessing:!0});case 23:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"performGridSearch",value:function(){var e=Object(p.a)(c.a.mark((function e(t,a,n){var r,o,i,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={score:-1},o=0;case 2:if(!(o<n)){e.next=11;break}return i=t+o*(a-t)/(n-1),(s=this.testForTopBannerAtScale(i)).score>r.score&&(r=s),e.next=8,new Promise((function(e){return setTimeout(e,10)}));case 8:o++,e.next=2;break;case 11:return console.log("Grid search over:",t,"to",a,"got:",r),e.abrupt("return",r);case 13:case"end":return e.stop()}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"testForBottomBanner",value:function(){var e=window.cv.imread("cv_canvasRef"),t=window.cv.imread("canvas_bottom_banner_new"),a=Math.round(t.size().width*this.boardFitParams.scale),n=Math.round(t.size().height*this.boardFitParams.scale),r=new window.cv.Mat,o=new window.cv.Size(a,n);window.cv.resize(t,r,o,0,0,window.cv.INTER_AREA);var i=new window.cv.Mat,s=new window.cv.Mat,l=window.cv.TM_CCOEFF_NORMED;window.cv.matchTemplate(e,r,i,l,s);var c=window.cv.minMaxLoc(i,s).maxLoc,u=new window.cv.Scalar(255,0,0,255),d=new window.cv.Point(c.x+r.cols,c.y+r.rows);window.cv.rectangle(e,c,d,u,2,window.cv.LINE_8,0),window.cv.imshow("cv_outputCanvasRef",e),e.delete(),t.delete(),r.delete(),i.delete(),s.delete(),this.boardFitParams.bottomBannerOffset={x:c.x,y:c.y}}},{key:"getCellXY",value:function(e,t){var a=(this.boardFitParams.bottomBannerOffset.y-this.boardFitParams.topBannerOffset.y)/(828*this.boardFitParams.scale);return(a<.95||a>1.05)&&(a=1),{x:this.boardFitParams.topBannerOffset.x+this.boardFitParams.scale*(161.5+75.5*e),y:this.boardFitParams.topBannerOffset.y+this.boardFitParams.scale*a*(239+78.6*t)}}},{key:"getSquidIndicatorXY",value:function(e){var t=(this.boardFitParams.bottomBannerOffset.y-this.boardFitParams.topBannerOffset.y)/(828*this.boardFitParams.scale);return(t<.95||t>1.05)&&(t=1),{x:this.boardFitParams.topBannerOffset.x+948*this.boardFitParams.scale,y:this.boardFitParams.topBannerOffset.y+this.boardFitParams.scale*t*(185+133*e)}}},{key:"getBoardRect",value:function(){var e=(this.boardFitParams.bottomBannerOffset.y-this.boardFitParams.topBannerOffset.y)/(828*this.boardFitParams.scale);return(e<.95||e>1.05)&&(e=1),new window.cv.Rect(Math.round(this.boardFitParams.topBannerOffset.x),Math.round(this.boardFitParams.topBannerOffset.y),Math.round(1040*this.boardFitParams.scale),Math.round(this.boardFitParams.scale*e*940))}},{key:"testForTopBannerAtScale",value:function(e){if(this.bannerCache.has(e))return this.bannerCache.get(e);var t=window.cv.imread("cv_canvasRef"),a=window.cv.imread("canvas_top_banner_new"),n=Math.round(a.size().width*e),r=Math.round(a.size().height*e),o=new window.cv.Mat,i=new window.cv.Size(n,r);window.cv.resize(a,o,i,0,0,window.cv.INTER_AREA);var s=new window.cv.Mat,l=new window.cv.Mat,c=window.cv.TM_CCOEFF_NORMED;window.cv.matchTemplate(t,o,s,c,l);var u=window.cv.minMaxLoc(s,l),d=u.maxLoc,h=new window.cv.Scalar(255,0,0,255),f=new window.cv.Point(d.x+o.cols,d.y+o.rows);window.cv.rectangle(t,d,f,h,2,window.cv.LINE_8,0),window.cv.imshow("cv_outputCanvasRef",t),t.delete(),a.delete(),o.delete(),s.delete(),l.delete();var p=u.maxVal;return this.bannerCache.set(e,p),{score:p,scale:e,topBannerOffset:{x:d.x,y:d.y}}}},{key:"readyToProcess",value:function(){return this.state.screenRecordingActive&&void 0!==this.boardFitParams&&this.boardFitParams.hasOwnProperty("bottomBannerOffset")}},{key:"readBoardState",value:function(){var e=Object(p.a)(c.a.mark((function e(){var t,a,n,r,o,i,s,l,u,d,f,p,b,v,m,w,y,g,x,k,S,E,_,C,M,O,B,R,T,P,F,A,I,j,q,z,L,G,N,U,D,V,H,W,Y,X,J,K,Z,$,Q,ee,te,ae,ne,re,oe,ie,se,le;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(le=function(e,t){if(null===e||null===t)return!1;for(var a=e.squidsGotten===t.squidsGotten,n=0;n<8;n++)for(var r=0;r<8;r++)e.grid[[r,n]]!==t.grid[[r,n]]&&(a=!1);return a},this.readyToProcess()){e.next=3;break}return e.abrupt("return");case 3:for(t={grid:{},squidsGotten:0},this.updateCapture(),a=performance.now(),n=window.cv.imread("cv_canvasRef"),r=new window.cv.Size(3,3),window.cv.GaussianBlur(n,n,r,0,0,window.cv.BORDER_DEFAULT),o=[n],i=function(e,t){var a=n.ucharPtr(Math.round(t),Math.round(e)),r={r:a[0],g:a[1],b:a[2]},o=Math.sqrt(r.r*r.r+r.g*r.g+r.b*r.b);return Object(h.a)({},r,{energy:o})},s=new window.cv.Scalar(80,80,80,255),l=new window.cv.Scalar(255,0,255,255),u=new window.cv.Scalar(100,255,0,255),d=new window.cv.Scalar(255,100,100,255),f=new window.cv.Scalar(50,255,100,255),p=null,b=-1,v=0;v<8;v++)for(m=0;m<8;m++)w=this.getCellXY(m,v),(y=i(w.x,w.y+15)).energy>b&&(b=y.energy,p={x:m,y:v});for(g=0;g<8;g++)for(x=0;x<8;x++)k=this.getCellXY(x,g),S=k.x,E=k.y,2,_=i(S,E),C=i(S-2,E-2),M=i(S+2,E-2),O=i(S-2,E+2),B=i(S+2,E+2),R=x===p.x&&g===p.y,T=R||x===p.x+1&&g===p.y,P=R||x===p.x-1&&g===p.y,F=R||x===p.x&&g===p.y+1,A=R||x===p.x&&g===p.y-1,I=F||T,j=F||P,q=A||T,z=A||P,L=s,G=R?240:220,N=(_.energy>=G)+(C.energy>=(I?240:220))+(M.energy>=(j?240:220))+(O.energy>=(q?240:220))+(B.energy>=(q?240:220)),U=R?1:1.02,D=(_.g>=_.b*U)+(C.g>=C.b*(I?U:1.05))+(M.g>=M.b*(j?U:1.05))+(O.g>=O.b*(q?U:1.05))+(B.g>=B.b*(z?U:1.05)),t.grid[[x,g]]=null,(N>=4&&D>=3||N>=3&&D>=4)&&(V=Math.max(_.r,C.r,M.r,O.r,B.r),H=Math.max(_.g,C.g,M.g,O.g,B.g),V>1.25*H?(L=l,t.grid[[x,g]]="HIT"):(L=u,t.grid[[x,g]]="MISS")),window.JUST_ONCE&&(R&&console.log("INSIDE!!!!!"),console.log("Scores:",x,g,R,D,_,C,M,O,B)),W=new window.cv.Point(S-7,E-7),Y=new window.cv.Point(S+7,E+7),window.cv.rectangle(n,W,Y,L,1,window.cv.LINE_8,0);for(X=0;X<3;X++)J=this.getSquidIndicatorXY(X),K=J.x,Z=J.y,$=n.ucharPtr(Math.round(Z),Math.round(K)),Q={r:$[0],g:$[1],b:$[2]},ee=new window.cv.Point(K-15,Z-15),te=new window.cv.Point(K+15,Z+15),ae=f,Q.r>1.25*Q.b&&(ae=d,t.squidsGotten=Math.max(t.squidsGotten,X+1)),window.cv.rectangle(n,ee,te,ae,1,window.cv.LINE_8,0);for(ne=this.getBoardRect(),re=n.roi(ne),o.push(re),window.cv.imshow("cv_outputCanvasRef",re),oe=0,ie=o;oe<ie.length;oe++)ie[oe].delete();if(se=performance.now(),console.log("CV took: "+(se-a)+"ms"),this.setState({lastCVTime:se-a}),le(this.previouslyReadStates[0],this.previouslyReadStates[1])||!le(this.previouslyReadStates[1],this.previouslyReadStates[2])||!le(this.previouslyReadStates[2],t)){e.next=33;break}return this.setState(t),e.next=33,this.doComputation(t.grid,t.squidsGotten);case 33:return this.previouslyReadStates.shift(),this.previouslyReadStates.push(t),e.abrupt("return",t);case 36:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateCapture",value:function(){var e=this.videoRef.current,t=this.canvasRef.current,a=t.getContext("2d"),n=Math.round(e.videoHeight/e.videoWidth*960);console.log("Native image capture shape: "+e.videoWidth+"x"+e.videoHeight+" -> scaling to: 960x"+n),t.width=960,t.height=n,a.drawImage(e,0,0,960,n)}},{key:"findMatchingLocations",value:c.a.mark((function e(t,a,n){var r,o,i,s,l,u,d;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=3;break}return e.next=3,[];case 3:r=t[0],o=this.boardTable,i=Math.min(o.length,a+n),s=a;case 7:if(!(s<i)){e.next=29;break}if(o[s]!==r){e.next=26;break}l=Object(f.a)(this.findMatchingLocations(t.slice(1),s,1e4)),e.prev=10,l.s();case 12:if((u=l.n()).done){e.next=18;break}return d=u.value,e.next=16,[s].concat(Object(y.a)(d));case 16:e.next=12;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(10),l.e(e.t0);case 23:return e.prev=23,l.f(),e.finish(23);case 26:s++,e.next=7;break;case 29:case"end":return e.stop()}}),e,this,[[10,20,23,26]])}))},{key:"doComputation",value:function(){var e=Object(p.a)(c.a.mark((function e(t,a){var n,r,o,i,s,l,u,d,h,p,b,v,m,w,y,g,x,k,S,E,_,C,M,O,B,R,F,A,I,j,q,z,L,G=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=performance.now(),r=[],o=[],i=0;i<8;i++)for(s=0;s<8;s++)"HIT"===(l=t[[s,i]])&&r.push(8*i+s),"MISS"===l&&o.push(8*i+s);for(u=-1,d=0,h=["0","1","2"];d<h.length;d++)a!==(p=h[d])&&a!==Number(p)||(u=Number(p));return e.next=8,N;case 8:if(!this.state.turboBlurboMode){e.next=51;break}v=this.layoutDrawingBoardRefs.map((function(e){return G.boardIndices[e.current.getLayoutString()]})),m=[],w=Object(f.a)(v),e.prev=12,w.s();case 14:if((y=w.n()).done){e.next=21;break}if(void 0!==(g=y.value)){e.next=18;break}return e.abrupt("break",21);case 18:m.push(g);case 19:e.next=14;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(12),w.e(e.t0);case 26:return e.prev=26,w.f(),e.finish(26);case 29:console.log("observedBoards:",m),x=[],k=Object(f.a)(this.findMatchingLocations(m,0,1e6));try{for(k.s();!(S=k.n()).done;)E=S.value,x.push(E)}catch(c){k.e(c)}finally{k.f()}this.setState({potentialMatches:x}),_=[],C=[],M=!0,O=0,B=[].concat(m,[null]);case 38:if(!(O<B.length)){e.next=47;break}if(void 0!==B[O]){e.next=42;break}return e.abrupt("break",47);case 42:M?(_.push(1e3*Number(this.state.firstBoardStepsThousands)),C.push(1e3*Number(this.state.firstBoardStepsThousandsStdDev))):(_.push(1e3*Number(this.state.nextBoardStepsThousands)),C.push(1e3*Number(this.state.nextBoardStepsThousandsStdDev))),M=!1;case 44:O++,e.next=38;break;case 47:console.log("Turbo:",m,_,C),b=P(Uint8Array.from(r),Uint8Array.from(o),u,Uint32Array.from(m),Uint32Array.from(_),Float64Array.from(C)),e.next=52;break;case 51:b=T(Uint8Array.from(r),Uint8Array.from(o),u,Uint32Array.from([]),Float64Array.from([]));case 52:if(void 0!==b){for(R=0,F=0,A=-1,I=[],j=0;j<8;j++)for(q=0;q<8;q++)I[[q,j]]=b[8*j+q],null===t[[q,j]]&&b[8*j+q]>A&&(A=b[8*j+q],F=q,R=j);z=b[64],this.setState({probs:I,best:A>=0?[F,R]:null,valid:!0,observationProb:z})}L=performance.now(),this.setState({lastComputationTime:L-n});case 55:case"end":return e.stop()}}),e,this,[[12,23,26,29]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"onClick",value:function(e,t){var a=Object(h.a)({},this.state.grid),n=a[[e,t]],r=this.state.squidsGotten;if("calculator"===this.state.mode){switch(n){case null:n="MISS";break;case"MISS":n="HIT";break;case"HIT":n=null}a[[e,t]]=n}else{if(null!==n)return;n=function(a){var n,r=Object(f.a)(a);try{for(r.s();!(n=r.n()).done;){var o=n.value;if(o[0]===e&&o[1]===t)return!0}}catch(i){r.e(i)}finally{r.f()}return!1}([].concat(Object(y.a)(this.state.squidLayout.squid2),Object(y.a)(this.state.squidLayout.squid3),Object(y.a)(this.state.squidLayout.squid4)))?"HIT":"MISS",a[[e,t]]=n,r=0;for(var o=0,i=["2","3","4"];o<i.length;o++){var s,l=i[o],c=this.state.squidLayout["squid"+l],u=!0,d=Object(f.a)(c);try{for(d.s();!(s=d.n()).done;){"HIT"!==a[s.value]&&(u=!1)}}catch(p){d.e(p)}finally{d.f()}r+=u}this.setState({squidsGotten:r})}this.setState({grid:a}),this.doComputation(a,r)}},{key:"clearField",value:function(){for(var e=this.makeEmptyState(),t={},a=0,n=["squidLayout","grid","squidsGotten"];a<n.length;a++){var r=n[a];t[r]=e[r]}this.setState(t),this.doComputation(t.grid,t.squidsGotten)}},{key:"renderActualMap",value:function(e){var t=this;return o.a.createElement("div",{style:{display:"inline-block"}},L(8).map((function(a){return o.a.createElement("div",{key:a,style:{display:"flex"}},L(8).map((function(n){return o.a.createElement(G,{key:n+","+a,x:n,y:a,onClick:function(){return t.onClick(n,a)},text:t.state.grid[[n,a]],prob:t.state.probs[[n,a]],valid:t.state.valid,best:t.state.best,precision:e?0:2,opacity:e?.5+.3*t.state.probs[[n,a]]:void 0})})))})))}},{key:"renderOverlayMap",value:function(){if(this.state.doVideoProcessing)return o.a.createElement("div",{style:{position:"absolute",top:"210px",left:"127px",transform:"scale(1.01, 1.05)",zIndex:20,display:"inline-block"}},this.renderActualMap(!0))}},{key:"render",value:function(){for(var e=this,t=0,a=!0,n=0;n<8;n++)for(var r=0;r<8;r++)null!==this.state.grid[[r,n]]&&(t++,"HIT"===this.state.grid[[r,n]]&&(a=!1));return o.a.createElement("div",{style:{margin:"20px"}},o.a.createElement("span",{style:{fontSize:"150%",color:"white"}},"Shots used: ",t),o.a.createElement("br",null),this.state.doVideoProcessing||this.renderActualMap(!1),this.state.valid||o.a.createElement("div",{style:{fontSize:"150%",color:"white"}},"Invalid configuration! This is not possible."),o.a.createElement("br",null),o.a.createElement("div",{style:{fontSize:"150%"}},o.a.createElement("span",{style:{color:"white"}},"Number of squids killed:"),o.a.createElement("select",{style:{marginLeft:"20px",fontSize:"100%"},value:this.state.squidsGotten,onChange:function(t){e.setState({squidsGotten:t.target.value}),e.doComputation(e.state.grid,t.target.value)}},o.a.createElement("option",{value:"unknown"},"Unknown"),o.a.createElement("option",{value:"0"},"0"),o.a.createElement("option",{value:"1"},"1"),o.a.createElement("option",{value:"2"},"2"),o.a.createElement("option",{value:"3"},"3")),o.a.createElement("br",null)),o.a.createElement("br",null),o.a.createElement("button",{style:{fontSize:"150%",margin:"10px"},onClick:function(){e.clearField()}},"Reset"),o.a.createElement("select",{style:{marginLeft:"20px",fontSize:"150%"},value:this.state.mode,onChange:function(t){return e.setState({mode:t.target.value})}},o.a.createElement("option",{value:"calculator"},"Calculator Mode"),o.a.createElement("option",{value:"practice"},"Practice Mode")),o.a.createElement("br",null),a&&!this.state.screenRecordingActive&&"calculator"===this.state.mode&&!this.state.turboBlurboMode&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{style:{color:"white",fontSize:"120%",marginTop:"20px"}},"Opening optimizer: Probability that this",o.a.createElement("br",null),"pattern would get at least one hit: ",this.state.valid?(100*Math.max(0,1-this.state.observationProb)).toFixed(2)+"%":"Invalid")),o.a.createElement("br",null),o.a.createElement("hr",null),"initializing"===this.state.turboBlurboMode&&o.a.createElement("div",{style:{fontSize:"150%",color:"white"}},"Downloading table...",o.a.createElement("br",null)),!0===this.state.turboBlurboMode&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",null,this.layoutDrawingBoardRefs.map((function(t,a){return o.a.createElement(J,{parent:e,ref:t,key:a})}))),o.a.createElement("div",{style:{color:"white",fontSize:"130%"}},"Gaussian RNG step count beliefs (all counts in ",o.a.createElement("i",null,"thousands")," of steps):",o.a.createElement("br",null),"First board mean:   ",o.a.createElement("input",{style:{width:"50px"},value:this.state.firstBoardStepsThousands,onInput:function(t){return e.setState({firstBoardStepsThousands:t.target.value})}})," \xa0 First board stddev: ",o.a.createElement("input",{style:{width:"50px"},value:this.state.firstBoardStepsThousandsStdDev,onInput:function(t){return e.setState({firstBoardStepsThousandsStdDev:t.target.value})}})," \xa0 Next board mean:    ",o.a.createElement("input",{style:{width:"50px"},value:this.state.nextBoardStepsThousands,onInput:function(t){return e.setState({nextBoardStepsThousands:t.target.value})}})," \xa0 Next board stddev:  ",o.a.createElement("input",{style:{width:"50px"},value:this.state.nextBoardStepsThousandsStdDev,onInput:function(t){return e.setState({nextBoardStepsThousandsStdDev:t.target.value})}})),o.a.createElement("div",{style:{margin:"20px",color:"white",fontSize:"130%",border:"1px solid white",width:"400px",minHeight:"20px",display:"inline-block"}},this.state.potentialMatches.map((function(e,t){return o.a.createElement("div",{key:t},"Potential match:",e.map((function(e,t){return o.a.createElement("span",{key:t}," ",e)})))}))),o.a.createElement("div",{style:{fontSize:"150%",color:"white"}},"Turbo blurbo mode initialized.",o.a.createElement("br",null))),o.a.createElement("button",{disabled:!1!==this.state.turboBlurboMode,style:{fontSize:"150%",margin:"10px"},onClick:function(){e.initializeTurboBlurboMode(!1)}},"Initialize Turbo Blurbo Mode"),o.a.createElement("br",null),o.a.createElement("button",{disabled:!1!==this.state.turboBlurboMode,style:{fontSize:"150%",margin:"10px"},onClick:function(){e.initializeTurboBlurboMode(!0)}},"Initialize Turbo Blurbo Mode (big table)"),o.a.createElement("br",null),o.a.createElement("span",{style:{color:"white"}},"Last recompute time: ",this.state.lastComputationTime,"ms"),o.a.createElement("div",{style:{display:"none"},ref:this.hiddenAreaRef}))}}]),a}(o.a.Component);document.addEventListener("keydown",(function(e){"p"===e.key&&null!==U&&U.toggleVideoProcessing()}));var Z=function(e){Object(m.a)(a,e);var t=Object(w.a)(a);function a(){return Object(b.a)(this,a),t.apply(this,arguments)}return Object(v.a)(a,[{key:"componentDidMount",value:function(){document.body.style.backgroundColor="#666"}},{key:"render",value:function(){return o.a.createElement("div",{style:{textAlign:"center"}},o.a.createElement("div",{style:{display:"inline-block",width:"600px"}},o.a.createElement("h1",{style:{color:"white"}},"Sploosh Kaboom Probability Calculator"),o.a.createElement("p",{style:{color:"white"}},"This page gives exact probabilities (no approximation) of hitting a squid in each cell, given the observation of hits, misses, and completed squid kills. Click on the map to cycle a cell between HIT and MISS. You can also set the number of squids completely killed in the drop-down menu at the bottom. You should set this to the value you see in the game for the number of squids killed. This will yield slightly more accurate probabilities. The highest probability location to play will be shown with a yellow outline. If you play perfectly according to picking the highlighted cell you will win in 20 or fewer shots \u224818.5% of the time.")),o.a.createElement(K,null),o.a.createElement("span",{style:{color:"white"}},"Made by Peter Schmidt-Nielsen and CryZe (v0.0.5)"))}}]),a}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(Z,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[124,1,2]]]);
//# sourceMappingURL=main.ff106cce.chunk.js.map