{"version":3,"sources":["wasm/sploosh_wasm.js","App.js","serviceWorker.js","index.js"],"names":["wasm","cachegetUint8Memory0","WASM_VECTOR_LEN","passArray8ToWasm0","arg","malloc","ptr","length","buffer","memory","Uint8Array","set","cachegetUint32Memory0","passArray32ToWasm0","Uint32Array","cachegetFloat64Memory0","getFloat64Memory0","Float64Array","passArrayF64ToWasm0","cachegetInt32Memory0","getInt32Memory0","Int32Array","getArrayF64FromWasm0","len","subarray","calculate_probabilities_with_board_constraints","hits","misses","squids_gotten","board_constraints","constraint_probs","ptr0","__wbindgen_malloc","len0","ptr1","len1","ptr2","len2","ptr3","len3","v4","r0","r1","slice","__wbindgen_free","calculate_probabilities_from_game_history","observed_boards","prior_steps_from_previous_means","prior_steps_from_previous_stddevs","ptr4","len4","v5","disambiguate_final_board","undefined","set_board_table","board_table","load","module","imports","a","Response","WebAssembly","instantiateStreaming","headers","get","console","warn","arrayBuffer","bytes","instantiate","instance","Instance","init","input","Request","URL","fetch","exports","__wbindgen_wasm_module","interpolate","require","globalDB","indexedDBreq","window","indexedDB","open","dbWrite","key","value","transaction","oncomplete","event","onerror","alert","objectStore","add","onsuccess","dbRead","Promise","resolve","reject","request","target","result","errorCode","onupgradeneeded","createObjectStore","colormap","naturalsUpTo","n","Array","keys","Tile","isBest","this","props","best","x","y","backgroundColor","text","prob","style","display","justifyContent","alignItems","textAlign","width","height","border","valid","outline","zIndex","fontFamily","userSelect","MozUserSelect","WebkitUserSelect","msUserSelect","color","fontSize","opacity","onClick","toFixed","precision","React","Component","process","globalMap","dbCachedFetch","url","callback","cacheMiss","req","XMLHttpRequest","responseType","onload","evt","response","send","catch","makeBoardIndicesTable","actuallyMakeBoardIndicesTable","descs","direction","push","allBoards","boardIndices","placeSquid","board","desc","i","fill","squid2","squid3","squid4","count","from","index","map","join","generateRandomChar","base58","array","crypto","getRandomValues","generateRandomToken","SPYWARE_HOST","globalSpyware","globalSpywareCounter","sendSpywareEvent","eventData","state","loggedIn","spywareMode","timestamp","Date","getTime","body","JSON","stringify","username","token","session","events","method","setState","charsSent","ok","errors","SpywareModeConfiguration","localStorage","getItem","setItem","defaultUsername","json","log","success","kind","version","bigTable","margin","padding","borderRadius","marginLeft","onLogout","data-stop-shortcuts","onChange","onLogin","marginTop","trigger","className","marginRight","href","sampleSquid","Math","round","random","cells","cell","newXY","LayoutDrawingBoard","grid","makeEmptyGrid","selectedCell","changeMade","dx","dy","countsBySquid","2","3","4","layoutString","getLayoutString","boardIndex","parent","isSelectedCell","backgroundImage","backgroundSize","globalBoardTimer","setInterval","forceUpdate","BoardTimer","previouslyAccumulatedSeconds","timerStartMS","timerRunning","includesLoadingTheRoom","includedRewardsGotten","invalidated","now","performance","elapsed","oldState","delta","max","min","total","timeDeltaSeconds","prediction","Number","timedTickIntercept","timedTickRate","roomEnteredOffset","getSecondsElapsed","guessStepsElapsedFromTime","textShadow","defaultConfigurationParams","firstBoardStepsThousands","firstBoardStepsThousandsStdDev","nextBoardStepsThousands","nextBoardStepsThousandsStdDev","timedBoardStepsThousandsStdDev","MainMap","videoRef","createRef","canvasRef","outputCanvasRef","hiddenAreaRef","layoutDrawingBoardRefs","timerRef","makeEmptyState","previouslyReadStates","doComputation","squidsGotten","probs","mode","squidLayout","layout","hitLocations","candidate","isAdmissible","generateLayout","undoBuffer","cursorBelief","observationProb","lastComputationTime","turboBlurboMode","turboBlurboTiming","showKeyShortcuts","timerStepEstimate","potentialMatches","savedSettings","parse","Object","name","configParams","settings","getConfigParams","boardIndexToLayoutString","buf","boardTable","v","observedBoards","startIndex","scanRange","soughtBoard","indexMax","findMatchingLocations","subResult","makeGameHistoryArguments","matches","match","rawObservedBoards","ref","current","ob","priorStepsFromPreviousMeans","priorStepsFromPreviousStdDevs","first","gridValue","numericSquidsGotten","t0","getGridStatistics","gameHistoryArguments","probabilities","maxY","maxX","highestProb","p1","p2","l1Distance","abs","distancePenaltyMultiplier","distanceAdjustedProb","t1","oldValid","didWeConcludeTheSituationWasValid","computationTime","setAsHit","copyToUndoBuffer","arr","arrayContains","squid","killed","templateState","newState","undoEntry","pop","oldGrid","incrementKills","boardTimer","numericValue","splitTimer","copyToHistory","newGrid","newNumericValue","finalBoard","fillIndex","shiftHistory","setStateFromLayoutString","drawingBoards","clearBoard","overlayMode","justifySelf","doVideoProcessing","position","top","left","transform","renderActualMap","usedShots","openingOptimizer","alignSelf","gridTemplateColumns","reportMiss","reportHit","clearField","type","checked","gridTemplateRows","justifyItems","gridColumn","gridRow","saveConfigParams","factoryResetConfigParams","minHeight","diffs","recomputePotentialMatches","disabled","initializeTurboBlurboMode","document","addEventListener","getAttribute","event_key","toLowerCase","ctrlKey","undoLastMarking","lower","toggleRunning","preventDefault","adjustRewards","toggleLoadingTheRoom","toggleInvalidated","resetTimer","App","Boolean","location","hostname","ReactDOM","render","StrictMode","getElementById","navigator","serviceWorker","ready","then","registration","unregister","error","message"],"mappings":"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","file":"static/js/main.45fdc048.chunk.js","sourcesContent":["\r\nlet wasm;\r\n\r\nlet cachegetUint8Memory0 = null;\r\nfunction getUint8Memory0() {\r\n    if (cachegetUint8Memory0 === null || cachegetUint8Memory0.buffer !== wasm.memory.buffer) {\r\n        cachegetUint8Memory0 = new Uint8Array(wasm.memory.buffer);\r\n    }\r\n    return cachegetUint8Memory0;\r\n}\r\n\r\nlet WASM_VECTOR_LEN = 0;\r\n\r\nfunction passArray8ToWasm0(arg, malloc) {\r\n    const ptr = malloc(arg.length * 1);\r\n    getUint8Memory0().set(arg, ptr / 1);\r\n    WASM_VECTOR_LEN = arg.length;\r\n    return ptr;\r\n}\r\n\r\nlet cachegetUint32Memory0 = null;\r\nfunction getUint32Memory0() {\r\n    if (cachegetUint32Memory0 === null || cachegetUint32Memory0.buffer !== wasm.memory.buffer) {\r\n        cachegetUint32Memory0 = new Uint32Array(wasm.memory.buffer);\r\n    }\r\n    return cachegetUint32Memory0;\r\n}\r\n\r\nfunction passArray32ToWasm0(arg, malloc) {\r\n    const ptr = malloc(arg.length * 4);\r\n    getUint32Memory0().set(arg, ptr / 4);\r\n    WASM_VECTOR_LEN = arg.length;\r\n    return ptr;\r\n}\r\n\r\nlet cachegetFloat64Memory0 = null;\r\nfunction getFloat64Memory0() {\r\n    if (cachegetFloat64Memory0 === null || cachegetFloat64Memory0.buffer !== wasm.memory.buffer) {\r\n        cachegetFloat64Memory0 = new Float64Array(wasm.memory.buffer);\r\n    }\r\n    return cachegetFloat64Memory0;\r\n}\r\n\r\nfunction passArrayF64ToWasm0(arg, malloc) {\r\n    const ptr = malloc(arg.length * 8);\r\n    getFloat64Memory0().set(arg, ptr / 8);\r\n    WASM_VECTOR_LEN = arg.length;\r\n    return ptr;\r\n}\r\n\r\nlet cachegetInt32Memory0 = null;\r\nfunction getInt32Memory0() {\r\n    if (cachegetInt32Memory0 === null || cachegetInt32Memory0.buffer !== wasm.memory.buffer) {\r\n        cachegetInt32Memory0 = new Int32Array(wasm.memory.buffer);\r\n    }\r\n    return cachegetInt32Memory0;\r\n}\r\n\r\nfunction getArrayF64FromWasm0(ptr, len) {\r\n    return getFloat64Memory0().subarray(ptr / 8, ptr / 8 + len);\r\n}\r\n/**\r\n* @param {Uint8Array} hits\r\n* @param {Uint8Array} misses\r\n* @param {number} squids_gotten\r\n* @param {Uint32Array} board_constraints\r\n* @param {Float64Array} constraint_probs\r\n* @returns {Float64Array | undefined}\r\n*/\r\nexport function calculate_probabilities_with_board_constraints(hits, misses, squids_gotten, board_constraints, constraint_probs) {\r\n    var ptr0 = passArray8ToWasm0(hits, wasm.__wbindgen_malloc);\r\n    var len0 = WASM_VECTOR_LEN;\r\n    var ptr1 = passArray8ToWasm0(misses, wasm.__wbindgen_malloc);\r\n    var len1 = WASM_VECTOR_LEN;\r\n    var ptr2 = passArray32ToWasm0(board_constraints, wasm.__wbindgen_malloc);\r\n    var len2 = WASM_VECTOR_LEN;\r\n    var ptr3 = passArrayF64ToWasm0(constraint_probs, wasm.__wbindgen_malloc);\r\n    var len3 = WASM_VECTOR_LEN;\r\n    wasm.calculate_probabilities_with_board_constraints(8, ptr0, len0, ptr1, len1, squids_gotten, ptr2, len2, ptr3, len3);\r\n    var r0 = getInt32Memory0()[8 / 4 + 0];\r\n    var r1 = getInt32Memory0()[8 / 4 + 1];\r\n    let v4;\r\n    if (r0 !== 0) {\r\n        v4 = getArrayF64FromWasm0(r0, r1).slice();\r\n        wasm.__wbindgen_free(r0, r1 * 8);\r\n    }\r\n    return v4;\r\n}\r\n\r\n/**\r\n* @param {Uint8Array} hits\r\n* @param {Uint8Array} misses\r\n* @param {number} squids_gotten\r\n* @param {Uint32Array} observed_boards\r\n* @param {Uint32Array} prior_steps_from_previous_means\r\n* @param {Float64Array} prior_steps_from_previous_stddevs\r\n* @returns {Float64Array | undefined}\r\n*/\r\nexport function calculate_probabilities_from_game_history(hits, misses, squids_gotten, observed_boards, prior_steps_from_previous_means, prior_steps_from_previous_stddevs) {\r\n    var ptr0 = passArray8ToWasm0(hits, wasm.__wbindgen_malloc);\r\n    var len0 = WASM_VECTOR_LEN;\r\n    var ptr1 = passArray8ToWasm0(misses, wasm.__wbindgen_malloc);\r\n    var len1 = WASM_VECTOR_LEN;\r\n    var ptr2 = passArray32ToWasm0(observed_boards, wasm.__wbindgen_malloc);\r\n    var len2 = WASM_VECTOR_LEN;\r\n    var ptr3 = passArray32ToWasm0(prior_steps_from_previous_means, wasm.__wbindgen_malloc);\r\n    var len3 = WASM_VECTOR_LEN;\r\n    var ptr4 = passArrayF64ToWasm0(prior_steps_from_previous_stddevs, wasm.__wbindgen_malloc);\r\n    var len4 = WASM_VECTOR_LEN;\r\n    wasm.calculate_probabilities_from_game_history(8, ptr0, len0, ptr1, len1, squids_gotten, ptr2, len2, ptr3, len3, ptr4, len4);\r\n    var r0 = getInt32Memory0()[8 / 4 + 0];\r\n    var r1 = getInt32Memory0()[8 / 4 + 1];\r\n    let v5;\r\n    if (r0 !== 0) {\r\n        v5 = getArrayF64FromWasm0(r0, r1).slice();\r\n        wasm.__wbindgen_free(r0, r1 * 8);\r\n    }\r\n    return v5;\r\n}\r\n\r\n/**\r\n* @param {Uint8Array} hits\r\n* @param {Uint32Array} observed_boards\r\n* @param {Uint32Array} prior_steps_from_previous_means\r\n* @param {Float64Array} prior_steps_from_previous_stddevs\r\n* @returns {number | undefined}\r\n*/\r\nexport function disambiguate_final_board(hits, observed_boards, prior_steps_from_previous_means, prior_steps_from_previous_stddevs) {\r\n    var ptr0 = passArray8ToWasm0(hits, wasm.__wbindgen_malloc);\r\n    var len0 = WASM_VECTOR_LEN;\r\n    var ptr1 = passArray32ToWasm0(observed_boards, wasm.__wbindgen_malloc);\r\n    var len1 = WASM_VECTOR_LEN;\r\n    var ptr2 = passArray32ToWasm0(prior_steps_from_previous_means, wasm.__wbindgen_malloc);\r\n    var len2 = WASM_VECTOR_LEN;\r\n    var ptr3 = passArrayF64ToWasm0(prior_steps_from_previous_stddevs, wasm.__wbindgen_malloc);\r\n    var len3 = WASM_VECTOR_LEN;\r\n    wasm.disambiguate_final_board(8, ptr0, len0, ptr1, len1, ptr2, len2, ptr3, len3);\r\n    var r0 = getInt32Memory0()[8 / 4 + 0];\r\n    var r1 = getInt32Memory0()[8 / 4 + 1];\r\n    return r0 === 0 ? undefined : r1 >>> 0;\r\n}\r\n\r\n/**\r\n* @param {Uint32Array} board_table\r\n*/\r\nexport function set_board_table(board_table) {\r\n    var ptr0 = passArray32ToWasm0(board_table, wasm.__wbindgen_malloc);\r\n    var len0 = WASM_VECTOR_LEN;\r\n    wasm.set_board_table(ptr0, len0);\r\n}\r\n\r\nasync function load(module, imports) {\r\n    if (typeof Response === 'function' && module instanceof Response) {\r\n\r\n        if (typeof WebAssembly.instantiateStreaming === 'function') {\r\n            try {\r\n                return await WebAssembly.instantiateStreaming(module, imports);\r\n\r\n            } catch (e) {\r\n                if (module.headers.get('Content-Type') != 'application/wasm') {\r\n                    console.warn(\"`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\\n\", e);\r\n\r\n                } else {\r\n                    throw e;\r\n                }\r\n            }\r\n        }\r\n\r\n        const bytes = await module.arrayBuffer();\r\n        return await WebAssembly.instantiate(bytes, imports);\r\n\r\n    } else {\r\n\r\n        const instance = await WebAssembly.instantiate(module, imports);\r\n\r\n        if (instance instanceof WebAssembly.Instance) {\r\n            return { instance, module };\r\n\r\n        } else {\r\n            return instance;\r\n        }\r\n    }\r\n}\r\n\r\nasync function init(input) {\r\n    //if (typeof input === 'undefined') {\r\n    //    input = import.meta.url.replace(/\\.js$/, '_bg.wasm');\r\n    //}\r\n    const imports = {};\r\n\r\n\r\n    if (typeof input === 'string' || (typeof Request === 'function' && input instanceof Request) || (typeof URL === 'function' && input instanceof URL)) {\r\n        input = fetch(input);\r\n    }\r\n\r\n    const { instance, module } = await load(await input, imports);\r\n\r\n    wasm = instance.exports;\r\n    init.__wbindgen_wasm_module = module;\r\n\r\n    return wasm;\r\n}\r\n\r\nexport default init;\r\n\r\n","import React from 'react';\r\nimport './App.css';\r\nimport Collapsible from 'react-collapsible';\r\nimport init, {\r\n    set_board_table,\r\n    calculate_probabilities_with_board_constraints,\r\n    calculate_probabilities_from_game_history,\r\n    disambiguate_final_board,\r\n} from './wasm/sploosh_wasm.js';\r\nconst interpolate = require('color-interpolate');\r\n\r\nconst VERSION_STRING = 'v0.0.19';\r\n\r\nvar globalDB = null;\r\nconst indexedDBreq = window.indexedDB.open('splooshkaboom', 1);\r\nindexedDBreq.onerror = function(event) {\r\n    alert('Failed to access IndexedDB.');\r\n};\r\n// Known issue: There's basically a race condition here in that I don't\r\n// wait for this onsuccess to potentially start calling dbRead.\r\nindexedDBreq.onsuccess = function(event) {\r\n    globalDB = event.target.result;\r\n    globalDB.onerror = function(event) {\r\n        alert('IndexedDB error: ' + event.target.errorCode);\r\n    };\r\n};\r\nindexedDBreq.onupgradeneeded = function(event) {\r\n    const db = event.target.result;\r\n    db.createObjectStore('sk');\r\n}\r\n\r\n// TODO: Am I using IndexedDB even remotely correctly!? This looks so weird...\r\n// Do I not have to somehow end or commit the transactions!?\r\n\r\nfunction dbWrite(key, value) {\r\n    if (globalDB === null)\r\n        return;\r\n\r\n    const transaction = globalDB.transaction(['sk'], 'readwrite');\r\n\r\n    transaction.oncomplete = function(event) {\r\n        //alert('Transaction complete!');\r\n    }\r\n    transaction.onerror = function(event) {\r\n        alert('Transaction error!');\r\n    }\r\n    const objectStore = transaction.objectStore('sk');\r\n    const request = objectStore.add(value, key);\r\n    request.onsuccess = function(event) {\r\n        //alert('Request success!');\r\n    }\r\n}\r\n\r\nfunction dbRead(key) {\r\n    return new Promise((resolve, reject) => {\r\n        const transaction = globalDB.transaction(['sk']);\r\n\r\n        transaction.oncomplete = function(event) {\r\n            //alert('Transaction complete!');\r\n        }\r\n        transaction.onerror = function(event) {\r\n            alert('Transaction error!');\r\n        }\r\n        const objectStore = transaction.objectStore('sk');\r\n        const request = objectStore.get(key);\r\n        request.onsuccess = function(event) {\r\n            //alert('Request success!');\r\n            resolve(event.target.result);\r\n        };\r\n        request.onerror = function(event) {\r\n            //alert('Request failure!');\r\n            reject();\r\n        };\r\n    });\r\n}\r\n\r\n//const colormap = interpolate(['#004', '#090', '#0a0', 'green']);\r\n//const colormap = interpolate(['#004', '#0a0', '#0d0', '#0f0', '#6f6']);\r\n// .        . . . .\r\n// 0123456789abcdef\r\nconst colormap = interpolate(['#004', '#070', '#090', '#0b0', '#0d0', '#0f0', '#6f6']);\r\nconst naturalsUpTo = (n) => [...Array(n).keys()];\r\n\r\nclass Tile extends React.Component {\r\n    render() {\r\n        const isBest = this.props.best !== null && this.props.best[0] === this.props.x && this.props.best[1] === this.props.y;\r\n\r\n        let backgroundColor = this.props.backgroundColor;\r\n        if (backgroundColor === undefined) {\r\n            backgroundColor = this.props.text === null ? colormap(this.props.prob) : (\r\n                this.props.text === 'HIT' ? '#a2a' : '#44a'\r\n            );\r\n        }\r\n\r\n        return <div\r\n            key={this.props.x + ',' + this.props.y}\r\n            style={{\r\n                display: 'flex',\r\n                justifyContent: 'center',\r\n                alignItems: 'center',\r\n                textAlign: 'center',\r\n                width: '70px',\r\n                height: '70px',\r\n                border: this.props.valid ? '1px solid grey' : '1px solid red',\r\n                outline: isBest ? '4px solid yellow' : '',\r\n                zIndex: isBest ? 1 : 0,\r\n                fontFamily: 'monospace',\r\n                userSelect: 'none',\r\n                MozUserSelect: 'none',\r\n                WebkitUserSelect: 'none',\r\n                msUserSelect: 'none',\r\n                color: 'white',\r\n                fontSize: this.props.fontSize,\r\n                opacity: this.props.opacity,\r\n                backgroundColor,\r\n            }}\r\n            onClick={this.props.onClick}\r\n        >\r\n            {this.props.text === null ? (this.props.prob * 100).toFixed(this.props.precision) + '%' : this.props.text}\r\n        </div>;\r\n    }\r\n}\r\n\r\nlet wasm = init(process.env.PUBLIC_URL + \"/sploosh_wasm_bg.wasm\");\r\n\r\n// Super ugly, please forgive me. :(\r\nvar globalMap = null;\r\n\r\nasync function dbCachedFetch(url, callback) {\r\n    function cacheMiss() {\r\n        const req = new XMLHttpRequest();\r\n        req.open('GET', process.env.PUBLIC_URL + url, true);\r\n        req.responseType = 'arraybuffer';\r\n        req.onload = (evt) => {\r\n            dbWrite(url, req.response);\r\n            callback(req.response);\r\n        };\r\n        req.send();\r\n        return null;\r\n    }\r\n    const result = await dbRead(url).catch(cacheMiss);\r\n    if (result === undefined) {\r\n        cacheMiss();\r\n        return;\r\n    }\r\n    // This is sort of an ugly protocol, but if we hit the catch path above\r\n    // we signal that the callback was already called by returning null.\r\n    if (result === null)\r\n        return;\r\n    callback(result);\r\n}\r\n\r\nasync function makeBoardIndicesTable() {\r\n    function cacheMiss() {\r\n        const result = actuallyMakeBoardIndicesTable();\r\n        dbWrite('boardIndicesTable', result);\r\n        return result;\r\n    }\r\n    const result = await dbRead('boardIndicesTable').catch(cacheMiss);\r\n    if (result === undefined)\r\n        return cacheMiss();\r\n    return result;\r\n}\r\n\r\nfunction actuallyMakeBoardIndicesTable() {\r\n    // This convention here has to match that in the Rust component and table building C++ exactly!\r\n    const descs = [];\r\n    for (let y = 0; y < 8; y++)\r\n        for (let x = 0; x < 8; x++)\r\n            for (const direction of [false, true])\r\n                descs.push({x, y, direction});\r\n    const allBoards = [];\r\n    const boardIndices = {};\r\n    function placeSquid(board, desc, length) {\r\n        for (let i = 0; i < length; i++) {\r\n            let {x, y} = desc;\r\n            if (desc.direction)\r\n                x += i;\r\n            else\r\n                y += i;\r\n            const index = x + 8 * y;\r\n            if (x >= 8 || y >= 8)\r\n                return;\r\n            board[index] = length;\r\n        }\r\n    }\r\n    const board = new Array(64).fill(0);\r\n\r\n    for (const squid2 of descs) {\r\n        for (const squid3 of descs) {\r\n            for (const squid4 of descs) {\r\n                board.fill(0);\r\n                placeSquid(board, squid2, 2);\r\n                placeSquid(board, squid3, 3);\r\n                placeSquid(board, squid4, 4);\r\n                let count = 0;\r\n                for (const entry of board)\r\n                    count += entry\r\n                if (count !== 2*2 + 3*3 + 4*4)\r\n                    continue;\r\n                allBoards.push(Array.from(board));\r\n            }\r\n        }\r\n    }\r\n    let index = 0;\r\n    for (const board of allBoards) {\r\n        boardIndices[board.map((i) => i === 0 ? '.' : i).join('')] = index;\r\n        index++;\r\n    }\r\n    return boardIndices;\r\n}\r\n\r\nfunction generateRandomChar() {\r\n    const base58 = '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';\r\n    const array = new Uint8Array(1);\r\n    while (true) {\r\n        crypto.getRandomValues(array);\r\n        const index = array[0] & 63;\r\n        if (index < base58.length)\r\n            return base58[index];\r\n    }\r\n}\r\n\r\nfunction generateRandomToken(n) {\r\n    let result = '';\r\n    for (let i = 0; i < n; i++)\r\n        result += generateRandomChar();\r\n    return result;\r\n}\r\n\r\n// Ugh, maybe later I'll give it a proper domain, and move over to https.\r\nconst SPYWARE_HOST = 'http://ec2-34-223-48-61.us-west-2.compute.amazonaws.com:1234';\r\n\r\nvar globalSpyware = null;\r\nvar globalSpywareCounter = -1;\r\n\r\nasync function sendSpywareEvent(eventData) {\r\n    if (globalSpyware === null || globalMap === null)\r\n        return;\r\n    if (!globalSpyware.state.loggedIn)\r\n        return;\r\n    if (!globalMap.state.spywareMode)\r\n        return;\r\n    eventData.timestamp = (new Date()). getTime() / 1000;\r\n    globalSpywareCounter++;\r\n    //console.log('Sending spyware event:', globalSpywareCounter, eventData);\r\n    const body = JSON.stringify({\r\n        username: globalSpyware.state.username,\r\n        token: globalSpyware.state.token,\r\n        session: globalSpyware.session,\r\n        events: {\r\n            [globalSpywareCounter]: eventData,\r\n        },\r\n    });\r\n    const response = await fetch(SPYWARE_HOST + '/write', {\r\n        method: 'POST',\r\n        headers: {'Content-Type': 'application/json'},\r\n        body,\r\n    });\r\n    globalSpyware.setState({charsSent: globalSpyware.state.charsSent + body.length});\r\n    if (!response.ok)\r\n        globalSpyware.setState({errors: true});\r\n}\r\n\r\nclass SpywareModeConfiguration extends React.Component {\r\n    constructor() {\r\n        super();\r\n        globalSpyware = this;\r\n        this.session = generateRandomToken(16);\r\n        let token = localStorage.getItem('SKToken');\r\n        if (token === null) {\r\n            token = generateRandomToken(8);\r\n            localStorage.setItem('SKToken', token);\r\n        }\r\n        let defaultUsername = localStorage.getItem('SKUsername');\r\n        this.state = {\r\n            username: defaultUsername === null ? '' : defaultUsername,\r\n            token,\r\n            loggedIn: false,\r\n            errors: false,\r\n            charsSent: false,\r\n        };\r\n    }\r\n\r\n    async onLogin() {\r\n        const username = this.state.username;\r\n        if (username === '') {\r\n            alert('Username must be non-empty');\r\n            return;\r\n        }\r\n        const response = await fetch(SPYWARE_HOST + '/login', {\r\n            method: 'POST',\r\n            headers: {'Content-Type': 'application/json'},\r\n            body: JSON.stringify({\r\n                'username': username,\r\n                'token': this.state.token,\r\n            }),\r\n        });\r\n        const result = await response.json();\r\n        console.log('Login:', result);\r\n        if (result.success) {\r\n            // Stash the username when we successfully log in, as a convenience for the user.\r\n            localStorage.setItem('SKUsername', username);\r\n            this.setState({loggedIn: true}, () => {\r\n                sendSpywareEvent({\r\n                    kind: 'login',\r\n                    version: VERSION_STRING,\r\n                    bigTable: globalMap === null ? null : globalMap.bigTable,\r\n                });\r\n            });\r\n        } else {\r\n            alert('Bad token! This username might already be taken. If you need to recover your login token contact Peter Schmidt-Nielsen.');\r\n        }\r\n    }\r\n\r\n    async onLogout() {\r\n        this.setState({loggedIn: false});\r\n    }\r\n\r\n    render() {\r\n        return <div style={{\r\n            fontSize: '120%',\r\n            margin: '10px',\r\n            padding: '10px',\r\n            border: '2px solid white',\r\n            borderRadius: '8px',\r\n            width: '450px',\r\n            display: 'inline-block',\r\n            backgroundColor: this.state.loggedIn ? '#696' : '#777',\r\n        }}>\r\n            <span style={{fontSize: '120%'}}>Spyware Mode:</span>\r\n            <br/>\r\n            {\r\n                this.state.loggedIn ?\r\n                    <>\r\n                        Logged in as: <span style={{fontFamily: 'monospace', fontSize: '150%'}}>{this.state.username}</span>\r\n                        <button style={{marginLeft: '20px'}} onClick={() => this.onLogout()}>Logout</button>\r\n                        <br/>\r\n                        Events sent: {globalSpywareCounter + 1} &nbsp;&nbsp;&nbsp; Chars sent: {this.state.charsSent}\r\n                    </> : <>\r\n                        Username: <input data-stop-shortcuts style={{width: '100px', fontFamily: 'monospace'}} value={this.state.username} onChange={event => this.setState({username: event.target.value})}/>\r\n                        <button style={{marginLeft: '20px'}} onClick={() => this.onLogin()}>Login</button>\r\n                    </>\r\n            }\r\n            <br/>\r\n            <div style={{marginTop: '20px'}}>\r\n                <Collapsible trigger={\r\n                    <div className=\"clickable\" style={{width: '200px', margin: '0px'}}>\r\n                        Access Token\r\n                    </div>\r\n                }>\r\n                    Token: <input data-stop-shortcuts style={{width: '120px', marginRight: '20px'}} value={this.state.token} onChange={event => this.setState({token: event.target.value})}/>\r\n                    <button onClick={() => { localStorage.setItem('SKToken', this.state.token); }}>Update Saved Token</button>\r\n                    <p>\r\n                        The above token is generated just for you.\r\n                        Anyone who has the above token can submit data that will appear on the stats page for your username (so I recommend not showing it on stream).\r\n                        If you lose access to it you'll have to pick a new username, or ask <a href=\"mailto:schmidtnielsenpeter@gmail.com\">Peter Schmidt-Nielsen</a> to help you recover your access token.\r\n                        The token is automatically saved between sessions, but might be lost if you clear all your browser history.\r\n                        I recommend copying this token down somewhere.\r\n                    </p>\r\n                </Collapsible>\r\n            </div>\r\n            {this.state.errors && <span style={{fontSize: '120%', color: 'red'}}>Spyware reporting error!</span>}\r\n        </div>;\r\n    }\r\n}\r\n\r\nfunction sampleSquid(length) {\r\n    const x = Math.round(Math.random() * 8);\r\n    const y = Math.round(Math.random() * 8);\r\n    const direction = Math.random() < 0.5;\r\n    const cells = [[x, y]];\r\n    for (let i = 0; i < length - 1; i++) {\r\n        const cell = cells[cells.length - 1];\r\n        const newXY = direction ? [cell[0] + 1, cell[1]] : [cell[0], cell[1] + 1];\r\n        cells.push(newXY);\r\n    }\r\n    return cells;\r\n}\r\n\r\nfunction generateLayout() {\r\n    const layout = {};\r\n    const hitLocations = {};\r\n    for (const n of [2, 3, 4]) {\r\n        while (true) {\r\n            const candidate = sampleSquid(n);\r\n            let isAdmissible = true;\r\n            for (const cell of candidate)\r\n                if (cell[0] > 7 || cell[1] > 7 || hitLocations[cell] === true)\r\n                    isAdmissible = false;\r\n            if (isAdmissible) {\r\n                layout['squid' + n] = candidate;\r\n                for (const cell of candidate)\r\n                    hitLocations[cell] = true;\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    return layout;\r\n}\r\n\r\nclass LayoutDrawingBoard extends React.Component {\r\n    constructor() {\r\n        super();\r\n        this.state = { grid: this.makeEmptyGrid(), selectedCell: null };\r\n    }\r\n\r\n    makeEmptyGrid() {\r\n        const grid = [];\r\n        for (let y = 0; y < 8; y++)\r\n            for (let x = 0; x < 8; x++)\r\n                grid[[x, y]] = '.';\r\n        return grid;\r\n    }\r\n\r\n    clearBoard() {\r\n        this.setState({ grid: this.makeEmptyGrid(), selectedCell: null });\r\n    }\r\n\r\n    onClick(x, y) {\r\n        if (this.state.selectedCell === null) {\r\n            this.setState({ selectedCell: [x, y] });\r\n            return;\r\n        }\r\n        const grid = {...this.state.grid};\r\n        let changeMade = false;\r\n        for (const length of [2, 3, 4]) {\r\n            for (const [dx, dy] of [[+1, 0], [0, +1], [-1, 0], [0, -1]]) {\r\n                if (this.state.selectedCell[0] === x + dx * (length - 1) && this.state.selectedCell[1] === y + dy * (length - 1)) {\r\n                    // If this squid appears anywhere else, obliterate it.\r\n                    for (let y = 0; y < 8; y++)\r\n                        for (let x = 0; x < 8; x++)\r\n                            if (grid[[x, y]] === '' + length)\r\n                                grid[[x, y]] = '.';\r\n                    // Fill in the squid here.\r\n                    for (let i = 0; i < length; i++)\r\n                        grid[[x + i * dx, y + i * dy]] = '' + length;\r\n                    changeMade = true;\r\n                }\r\n            }\r\n        }\r\n        // If any squid has the wrong count, then totally eliminate it.\r\n        const countsBySquid = {2: 0, 3: 0, 4: 0, '.': 0};\r\n        for (let y = 0; y < 8; y++)\r\n            for (let x = 0; x < 8; x++)\r\n                countsBySquid[grid[[x, y]]]++;\r\n        for (const length of [2, 3, 4])\r\n            if (countsBySquid[length] !== length)\r\n                for (let y = 0; y < 8; y++)\r\n                    for (let x = 0; x < 8; x++)\r\n                        if (grid[[x, y]] === '' + length)\r\n                            grid[[x, y]] = '.';\r\n        if (changeMade)\r\n            this.setState({ grid });\r\n        this.setState({ selectedCell: null });\r\n    }\r\n\r\n    getLayoutString() {\r\n        // Quadratic time, but who cares?\r\n        let layoutString = '';\r\n        for (let y = 0; y < 8; y++)\r\n            for (let x = 0; x < 8; x++)\r\n                layoutString += this.state.grid[[x, y]];\r\n        return layoutString;\r\n    }\r\n\r\n    setStateFromLayoutString(layoutString) {\r\n        const grid = [];\r\n        for (let y = 0; y < 8; y++)\r\n            for (let x = 0; x < 8; x++)\r\n                grid[[x, y]] = layoutString[x + 8 * y];\r\n        this.setState({grid});\r\n    }\r\n\r\n    render() {\r\n        const layoutString = this.getLayoutString();\r\n        let boardIndex = this.props.parent.boardIndices[layoutString];\r\n        if (boardIndex === undefined) {\r\n            boardIndex = \"waiting...\";\r\n        }\r\n        const isSelectedCell = (x, y) => this.state.selectedCell !== null && x === this.state.selectedCell[0] && y === this.state.selectedCell[1];\r\n\r\n        return <div style={{\r\n            margin: '20px',\r\n            display: 'inline-block',\r\n            color: 'white',\r\n        }}>\r\n            <div style={{\r\n                backgroundImage: 'url(\"' + process.env.PUBLIC_URL + '/board_background_square.png\")',\r\n                backgroundSize: '100% 100%',\r\n                padding: '18px',\r\n            }}>\r\n                {naturalsUpTo(8).map(\r\n                    (y) => <div key={y} style={{\r\n                        display: 'flex',\r\n                    }}>\r\n                        {naturalsUpTo(8).map(\r\n                            (x) => <Tile\r\n                                key={x + ',' + y}\r\n                                x={x} y={y}\r\n                                onClick={() => this.onClick(x, y)}\r\n                                text={this.state.grid[[x, y]]}\r\n                                valid={true}\r\n                                best={this.state.selectedCell}\r\n                                fontSize={'200%'}\r\n                                opacity={isSelectedCell(x, y) || this.state.grid[[x, y]] !== '.' ? 0.6 : 0.2}\r\n                                backgroundColor={this.state.grid[[x, y]] === '.' ? undefined : 'green'}\r\n                            />\r\n                        )}\r\n                    </div>\r\n                )}\r\n            </div><br/>\r\n            Squid Layout: {boardIndex}\r\n        </div>;\r\n    }\r\n}\r\n\r\nvar globalBoardTimer = null;\r\n\r\nsetInterval(\r\n    () => {\r\n        if (globalBoardTimer !== null)\r\n            globalBoardTimer.forceUpdate();\r\n    },\r\n    69,\r\n);\r\n\r\nfunction renderYesNo(bool) {\r\n    return bool ?\r\n        <span style={{color: 'green', textShadow: '0px 0px 2px white'}}>YES</span> :\r\n        <span style={{color: 'red', textShadow: '0px 0px 2px white'}}>NO</span>;\r\n}\r\n\r\nclass BoardTimer extends React.Component {\r\n    constructor() {\r\n        super();\r\n        globalBoardTimer = this;\r\n        this.state = {\r\n            previouslyAccumulatedSeconds: 0.0,\r\n            //previouslyAccumulatedRupeeSeconds: 0.0,\r\n            timerStartMS: 0.0,\r\n            timerRunning: false,\r\n            includesLoadingTheRoom: true,\r\n            //rupeesCollected: false,\r\n            includedRewardsGotten: 0,\r\n            invalidated: false,\r\n        };\r\n    }\r\n\r\n    toggleRunning() {\r\n        const now = performance.now();\r\n        const elapsed = 1e-3 * (now - this.state.timerStartMS);\r\n        sendSpywareEvent({kind: 'timer_toggleRunning', elapsed, oldState: this.state});\r\n        if (this.state.timerRunning)\r\n            this.setState({previouslyAccumulatedSeconds: this.state.previouslyAccumulatedSeconds + elapsed});\r\n        this.setState({timerRunning: !this.state.timerRunning, timerStartMS: now});\r\n    }\r\n\r\n    adjustRewards(delta) {\r\n        sendSpywareEvent({kind: 'timer_adjustRewards', delta, oldState: this.state});\r\n        this.setState({includedRewardsGotten: Math.max(0, Math.min(2, this.state.includedRewardsGotten + delta))});\r\n    }\r\n\r\n    toggleLoadingTheRoom() {\r\n        sendSpywareEvent({kind: 'timer_toggleLoadingTheRoom', oldState: this.state});\r\n        this.setState({includesLoadingTheRoom: !this.state.includesLoadingTheRoom});\r\n    }\r\n\r\n    toggleInvalidated() {\r\n        sendSpywareEvent({kind: 'timer_toggleInvalidated', oldState: this.state});\r\n        this.setState({invalidated: !this.state.invalidated});\r\n    }\r\n\r\n    /*\r\n    toggleRupeesCollected() {\r\n        // TODO: Appropriately perform accumulation, then change the rate.\r\n        this.setState({rupeesCollected: !this.state.rupeesCollected});\r\n    }\r\n    */\r\n\r\n    resetTimer() {\r\n        sendSpywareEvent({kind: 'timer_resetTimer', oldState: this.state});\r\n        this.setState({\r\n            previouslyAccumulatedSeconds: 0.0,\r\n            timerStartMS: performance.now(),\r\n            timerRunning: false,\r\n        });\r\n    }\r\n\r\n    getSecondsElapsed() {\r\n        let total = this.state.previouslyAccumulatedSeconds;\r\n        if (this.state.timerRunning) {\r\n            const now = performance.now();\r\n            total += 1e-3 * (now - this.state.timerStartMS);\r\n        }\r\n        return total;\r\n    }\r\n\r\n    guessStepsElapsedFromTime(timeDeltaSeconds) {\r\n        // I did some linear regressions from real HD Italian runs. I'll put some data up at some point.\r\n        let prediction = Number(this.props.timedTickIntercept) + Number(this.props.timedTickRate) * timeDeltaSeconds;\r\n        if (this.state.includesLoadingTheRoom)\r\n            prediction += -940 + Number(this.props.roomEnteredOffset);\r\n        prediction += this.state.includedRewardsGotten * 760;\r\n        return Math.round(prediction);\r\n    }\r\n\r\n    render() {\r\n        const elapsed = this.getSecondsElapsed();\r\n        if (this.state.invalidated)\r\n            return <>\r\n                <span style={{ fontSize: '150%', color: 'white', fontFamily: 'monospace' }}>TIMER</span>\r\n                <span style={{ fontSize: '150%', color: 'white', fontFamily: 'monospace' }}>INVALIDATED</span>\r\n            </>;\r\n        return <>\r\n            <span>&nbsp;Seconds elapsed: </span>\r\n            <span>&nbsp;{elapsed.toFixed(2)}&nbsp;</span>\r\n            <span>&nbsp;Steps:&nbsp;</span>\r\n            <span>&nbsp;{this.guessStepsElapsedFromTime(elapsed)}&nbsp;</span>\r\n            <span>&nbsp;Entered room:</span>\r\n            <span>&nbsp;{renderYesNo(this.state.includesLoadingTheRoom)}&nbsp;</span>\r\n            <span>&nbsp;Rewards gotten:&nbsp;</span>\r\n            <span>&nbsp;{this.state.includedRewardsGotten}&nbsp;</span>\r\n        </>;\r\n            {/* &nbsp;- Rupees collected: {renderYesNo(this.state.rupeesCollected)} */};\r\n    }\r\n}\r\n\r\nfunction computeL1Distance(p1, p2) {\r\n    return Math.abs(p1[0] - p2[0]) + Math.abs(p1[1] - p2[1]);\r\n}\r\n\r\nconst defaultConfigurationParams = {\r\n    firstBoardStepsThousands: 500,\r\n    firstBoardStepsThousandsStdDev: 500,\r\n    nextBoardStepsThousands: 7,\r\n    nextBoardStepsThousandsStdDev: 3,\r\n    timedBoardStepsThousandsStdDev: 0.2,\r\n    timedTickIntercept: 156,\r\n    timedTickRate: 252,\r\n    roomEnteredOffset: 0,\r\n};\r\n\r\nclass MainMap extends React.Component {\r\n    videoRef = React.createRef();\r\n    canvasRef = React.createRef();\r\n    //referenceCanvasRef = React.createRef();\r\n    outputCanvasRef = React.createRef();\r\n    hiddenAreaRef = React.createRef();\r\n    layoutDrawingBoardRefs = [React.createRef(), React.createRef(), React.createRef()];\r\n    timerRef = React.createRef();\r\n\r\n    constructor() {\r\n        super();\r\n        this.state = this.makeEmptyState();\r\n        globalMap = this;\r\n        this.previouslyReadStates = [null, null, null];\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.doComputation(this.state.grid, this.state.squidsGotten);\r\n    }\r\n\r\n    makeEmptyGrid() {\r\n        const grid = [];\r\n        for (let y = 0; y < 8; y++)\r\n            for (let x = 0; x < 8; x++)\r\n                grid[[x, y]] = null;\r\n        return grid;\r\n    }\r\n\r\n    makeEmptyState() {\r\n        const probs = [];\r\n        for (let y = 0; y < 8; y++)\r\n            for (let x = 0; x < 8; x++)\r\n                probs[[x, y]] = 0.0;\r\n        // Select a particular layout, for practice mode.\r\n        const squidLayout = generateLayout();\r\n        const state = {\r\n            mode: 'calculator',\r\n            squidLayout,\r\n            grid: this.makeEmptyGrid(),\r\n            squidsGotten: 'unknown',\r\n            undoBuffer: [],\r\n            probs,\r\n            best: [3, 3],\r\n            cursorBelief: [3, 3],\r\n            valid: true,\r\n            observationProb: 1.0,\r\n            lastComputationTime: -1,\r\n\r\n            turboBlurboMode: false,\r\n            turboBlurboTiming: false,\r\n            showKeyShortcuts: false,\r\n            spywareMode: false,\r\n\r\n            timerStepEstimate: null,\r\n\r\n            potentialMatches: [],\r\n        };\r\n        // Load relevant configuration from localStorage.\r\n        let savedSettings = localStorage.getItem('SKSettings');\r\n        if (savedSettings === null) {\r\n            savedSettings = defaultConfigurationParams;\r\n        } else {\r\n            // if saved configuration from previous version, use defaults for \r\n            // any new parameters\r\n            savedSettings = JSON.parse(savedSettings);\r\n            for (const name of Object.keys(defaultConfigurationParams)) {\r\n                if (!(name in savedSettings)){\r\n                    savedSettings[name] = defaultConfigurationParams[name];\r\n                }\r\n            }\r\n        }\r\n        const configParams = savedSettings;\r\n        return {...state, ...configParams};\r\n    }\r\n\r\n    getConfigParams() {\r\n        const settings = {};\r\n        for (const name of Object.keys(defaultConfigurationParams))\r\n            settings[name] = Number(this.state[name]);\r\n        return settings;\r\n    }\r\n\r\n    saveConfigParams() {\r\n        const configParams = this.getConfigParams();\r\n        console.log('Saving config params:', configParams);\r\n        localStorage.setItem('SKSettings', JSON.stringify(configParams));\r\n    }\r\n\r\n    factoryResetConfigParams() {\r\n        this.setState(defaultConfigurationParams);\r\n    }\r\n\r\n    async initializeTurboBlurboMode(bigTable) {\r\n        if (this.state.turboBlurboMode !== false)\r\n            return;\r\n        this.bigTable = bigTable;\r\n        this.setState({turboBlurboMode: 'initializing'});\r\n        this.boardIndices = await makeBoardIndicesTable();\r\n        this.boardIndexToLayoutString = new Array(Object.keys(this.boardIndices).length);\r\n        for (const key of Object.keys(this.boardIndices))\r\n            this.boardIndexToLayoutString[this.boardIndices[key]] = key;\r\n\r\n        const tableName = bigTable ? '/board_table_25M.bin' : '/board_table_5M.bin';\r\n        dbCachedFetch(tableName, (buf) => {\r\n            this.boardTable = new Uint32Array(buf);\r\n            // Warning: Do I need to await wasm here first?\r\n            console.log('Board table length:', this.boardTable.length);\r\n            // Make sure every value is in range.\r\n            for (const v of this.boardTable)\r\n                if (v > 604583)\r\n                    alert('BUG BUG BUG: Bad value in board table: ' + v);\r\n            set_board_table(this.boardTable);\r\n            this.setState({turboBlurboMode: true, squidsGotten: '0', mode: 'calculator'});\r\n        });\r\n    }\r\n\r\n    *findMatchingLocations(observedBoards, startIndex, scanRange) {\r\n        if (observedBoards.length === 0) {\r\n            yield [];\r\n            return;\r\n        }\r\n        // Try to find the first match.\r\n        const soughtBoard = observedBoards[0];\r\n        const boardTable = this.boardTable;\r\n        const indexMax = Math.min(boardTable.length, startIndex + scanRange);\r\n        for (let i = startIndex; i < indexMax; i++)\r\n            if (boardTable[i] === soughtBoard)\r\n                for (const subResult of this.findMatchingLocations(observedBoards.slice(1), i, 50000))\r\n                    yield [i, ...subResult];\r\n    }\r\n\r\n    recomputePotentialMatches() {\r\n        const [observedBoards, _1, _2] = this.makeGameHistoryArguments();\r\n        const matches = [];\r\n        for (const match of this.findMatchingLocations(observedBoards, 0, 1000000000))\r\n            matches.push(match);\r\n        sendSpywareEvent({kind: 'recomputePotentialMatches', matches});\r\n        if (matches[0].length == 0) {\r\n            matches.length = 0;\r\n            matches.push([null, null]);\r\n        }\r\n        this.setState({potentialMatches: matches});\r\n    }\r\n\r\n    makeGameHistoryArguments() {\r\n        // Figure out how many history boards we have.\r\n        const rawObservedBoards = this.layoutDrawingBoardRefs\r\n            .map((ref) => this.boardIndices[ref.current.getLayoutString()]);\r\n        const observedBoards = [];\r\n        for (const ob of rawObservedBoards) {\r\n            if (ob === undefined)\r\n                break;\r\n            observedBoards.push(ob);\r\n        }\r\n\r\n        // The optimal thing to do here is to save the sequence of step delta estimates, but to make\r\n        // the tool less fragile we only use our timer-based estimates for the very final mean.\r\n\r\n        const priorStepsFromPreviousMeans = [];\r\n        const priorStepsFromPreviousStdDevs = [];\r\n        let first = true;\r\n        for (const index of [...observedBoards, null]) {\r\n            if (index === undefined)\r\n                break;\r\n            if (first) {\r\n                priorStepsFromPreviousMeans.push(1000.0 * Number(this.state.firstBoardStepsThousands));\r\n                priorStepsFromPreviousStdDevs.push(1000.0 * Number(this.state.firstBoardStepsThousandsStdDev));\r\n            } else {\r\n                // If we're the last delta, and also not the first, then possibly use our time delta.\r\n                if (index === null && this.state.timerStepEstimate !== null && this.state.turboBlurboTiming) {\r\n                    // Because the timerStepEstimate can be negative I have to avoid underflow.\r\n                    priorStepsFromPreviousMeans.push(Math.max(0, this.state.timerStepEstimate));\r\n                    priorStepsFromPreviousStdDevs.push(1000.0 * Number(this.state.timedBoardStepsThousandsStdDev));\r\n                } else {\r\n                    priorStepsFromPreviousMeans.push(1000.0 * Number(this.state.nextBoardStepsThousands));\r\n                    priorStepsFromPreviousStdDevs.push(1000.0 * Number(this.state.nextBoardStepsThousandsStdDev));\r\n                }\r\n            }\r\n            first = false;\r\n        }\r\n        return [\r\n            Uint32Array.from(observedBoards),\r\n            Uint32Array.from(priorStepsFromPreviousMeans),\r\n            Float64Array.from(priorStepsFromPreviousStdDevs),\r\n        ];\r\n    }\r\n\r\n    getGridStatistics(grid, squidsGotten) {\r\n        const hits = [];\r\n        const misses = [];\r\n        for (let y = 0; y < 8; y++) {\r\n            for (let x = 0; x < 8; x++) {\r\n                const gridValue = grid[[x, y]];\r\n                if (gridValue === 'HIT')\r\n                    hits.push(8 * y + x);\r\n                if (gridValue === 'MISS')\r\n                    misses.push(8 * y + x);\r\n            }\r\n        }\r\n        let numericSquidsGotten = -1;\r\n        for (const n of ['0', '1', '2', '3'])\r\n            if (squidsGotten === n || squidsGotten === Number(n))\r\n                numericSquidsGotten = Number(n);\r\n        return {hits, misses, numericSquidsGotten};\r\n    }\r\n\r\n    async doComputation(grid, squidsGotten) {\r\n        console.log('Doing computation:', squidsGotten, grid);\r\n        const t0 = performance.now();\r\n        const {hits, misses, numericSquidsGotten} = this.getGridStatistics(grid, squidsGotten);\r\n\r\n        await wasm;\r\n        let probabilities;\r\n        let gameHistoryArguments = null;\r\n        if (this.state.turboBlurboMode) {\r\n            gameHistoryArguments = this.makeGameHistoryArguments();\r\n            console.log('gameHistoryArguments:', gameHistoryArguments);\r\n\r\n            probabilities = calculate_probabilities_from_game_history(\r\n                Uint8Array.from(hits),\r\n                Uint8Array.from(misses),\r\n                numericSquidsGotten,\r\n                ...gameHistoryArguments,\r\n            );\r\n        } else {\r\n            probabilities = calculate_probabilities_with_board_constraints(\r\n                Uint8Array.from(hits),\r\n                Uint8Array.from(misses),\r\n                numericSquidsGotten,\r\n                // No constraints for now.\r\n                Uint32Array.from([]),\r\n                Float64Array.from([]),\r\n            );\r\n        }\r\n\r\n        let valid = true;\r\n        if (probabilities !== undefined) {\r\n            let maxY = 0;\r\n            let maxX = 0;\r\n            let highestProb = -1;\r\n            let probs = [];\r\n\r\n            // Here we implement our L1 distance bonus heuristic.\r\n            // The idea is that we want to highlight a square that isn't too far from where\r\n            // the player last adjusted the board. (i.e. where we believe their cursor is.)\r\n            for (let y = 0; y < 8; y++) {\r\n                for (let x = 0; x < 8; x++) {\r\n                    probs[[x, y]] = probabilities[8 * y + x];\r\n                    const l1Distance = computeL1Distance(this.state.cursorBelief, [x, y]);\r\n                    const distancePenaltyMultiplier = 1 - 0.03 * l1Distance;\r\n                    const distanceAdjustedProb = probabilities[8 * y + x] * distancePenaltyMultiplier;\r\n                    if (grid[[x, y]] === null && distanceAdjustedProb > highestProb) {\r\n                        highestProb = distanceAdjustedProb;\r\n                        maxX = x;\r\n                        maxY = y;\r\n                    }\r\n                }\r\n            }\r\n            const observationProb = probabilities[64];\r\n            this.setState({ probs, best: highestProb >= 0 ? [maxX, maxY] : null, valid, observationProb });\r\n        } else {\r\n            valid = false;\r\n            this.setState({ valid });\r\n        }\r\n        const t1 = performance.now();\r\n        this.setState({lastComputationTime: t1 - t0});\r\n        // Send a really big payload.\r\n        sendSpywareEvent({\r\n            kind: 'doComputation',\r\n            grid, hits, misses, numericSquidsGotten,\r\n            oldValid: this.state.valid,\r\n            didWeConcludeTheSituationWasValid: valid,\r\n            probabilities: Array.from(probabilities),\r\n            turboBlurboMode: this.state.turboBlurboMode,\r\n            turboBlurboTiming: this.state.turboBlurboTiming,\r\n            gameHistoryArguments: (gameHistoryArguments === null) ? [] : gameHistoryArguments.map(a => Array.from(a)),\r\n            timerStepEstimate: this.state.timerStepEstimate,\r\n            computationTime: (t1 - t0) / 1000,\r\n            configParams: this.getConfigParams(),\r\n        });\r\n    }\r\n\r\n    copyToUndoBuffer() {\r\n        this.setState({undoBuffer: [\r\n            ...this.state.undoBuffer,\r\n            {grid: this.state.grid, squidsGotten: this.state.squidsGotten, cursorBelief: this.state.cursorBelief},\r\n        ]});\r\n    }\r\n\r\n    onClick(x, y, setAsHit) {\r\n        sendSpywareEvent({kind: 'onClick', x, y, setAsHit});\r\n        const grid = { ...this.state.grid };\r\n        let gridValue = grid[[x, y]];\r\n        let squidsGotten = this.state.squidsGotten;\r\n        this.copyToUndoBuffer();\r\n\r\n        if (this.state.mode === 'calculator') {\r\n            switch (gridValue) {\r\n                case null:\r\n                    gridValue = setAsHit ? 'HIT' : 'MISS';\r\n                    break;\r\n                case 'MISS':\r\n                    gridValue = 'HIT';\r\n                    break;\r\n                case 'HIT':\r\n                    gridValue = null;\r\n                    break;\r\n            }\r\n            grid[[x, y]] = gridValue;\r\n        } else {\r\n            // Determine from the random layout.\r\n            if (gridValue !== null)\r\n                return;\r\n            const arrayContains = (arr) => {\r\n                for (const cell of arr)\r\n                    if (cell[0] === x && cell[1] === y)\r\n                        return true;\r\n                return false;\r\n            }\r\n            if (arrayContains([...this.state.squidLayout.squid2, ...this.state.squidLayout.squid3, ...this.state.squidLayout.squid4])) {\r\n                gridValue = 'HIT';\r\n            } else {\r\n                gridValue = 'MISS';\r\n            }\r\n            grid[[x, y]] = gridValue;\r\n            // Compute the killed squid count.\r\n            squidsGotten = 0;\r\n            for (const n of ['2', '3', '4']) {\r\n                const squid = this.state.squidLayout['squid' + n];\r\n                let killed = true;\r\n                for (const cell of squid)\r\n                    if (grid[cell] !== 'HIT')\r\n                        killed = false;\r\n                squidsGotten += killed;\r\n            }\r\n            this.setState({ squidsGotten });\r\n        }\r\n        this.setState({grid, cursorBelief: [x, y]});\r\n        this.doComputation(grid, squidsGotten);\r\n    }\r\n\r\n    clearField() {\r\n        sendSpywareEvent({kind: 'clearField'});\r\n        const templateState = this.makeEmptyState();\r\n        const newState = {};\r\n        for (const name of ['squidLayout', 'grid', 'squidsGotten', 'undoBuffer', 'cursorBelief'])\r\n            newState[name] = templateState[name];\r\n        // The squidsGotten value of 'unknown' is banned in turbo blurbo mode.\r\n        if (this.state.turboBlurboMode)\r\n            newState.squidsGotten = '0';\r\n        this.setState(newState);\r\n        this.doComputation(newState.grid, newState.squidsGotten);\r\n    }\r\n\r\n    undoLastMarking() {\r\n        const undoBuffer = [...this.state.undoBuffer];\r\n        if (undoBuffer.length === 0)\r\n            return;\r\n        const undoEntry = undoBuffer.pop();\r\n        sendSpywareEvent({kind: 'undoLastMarking', undoEntry});\r\n        this.setState({grid: undoEntry.grid, squidsGotten: undoEntry.squidsGotten, cursorBelief: undoEntry.cursorBelief, undoBuffer});\r\n        this.doComputation(undoEntry.grid, undoEntry.squidsGotten);\r\n    }\r\n\r\n    reportMiss() {\r\n        if (this.state.best !== null && this.state.grid[this.state.best] === null) {\r\n            sendSpywareEvent({kind: 'reportMiss', best: this.state.best, oldGrid: this.state.grid});\r\n            this.onClick(...this.state.best);\r\n        }\r\n    }\r\n\r\n    reportHit() {\r\n        if (this.state.best !== null && this.state.grid[this.state.best] === null) {\r\n            sendSpywareEvent({kind: 'reportHit', best: this.state.best, oldGrid: this.state.grid});\r\n            this.onClick(...this.state.best, true);\r\n            const {hits, misses, numericSquidsGotten} = this.getGridStatistics(this.state.grid, this.state.squidsGotten);\r\n            if (hits.length === 9) {\r\n                this.incrementKills();\r\n            }\r\n        }\r\n    }\r\n\r\n    splitTimer() {\r\n        const boardTimer = this.timerRef.current;\r\n        if (boardTimer === null)\r\n            return;\r\n        const elapsed = boardTimer.getSecondsElapsed();\r\n        const timerStepEstimate = boardTimer.state.invalidated ? null : boardTimer.guessStepsElapsedFromTime(elapsed);\r\n        this.setState({timerStepEstimate});\r\n        console.log('Timer step estimate:', timerStepEstimate);\r\n        sendSpywareEvent({kind: 'splitTimer', invalidated: boardTimer.state.invalidated, timerStepEstimate: timerStepEstimate, elapsed});\r\n        boardTimer.setState({\r\n            previouslyAccumulatedSeconds: 0.0,\r\n            timerStartMS: performance.now(),\r\n            // After the first split we're no longer loading the room.\r\n            includesLoadingTheRoom: false,\r\n            includedRewardsGotten: 0,\r\n            timerRunning: true,\r\n            invalidated: false,\r\n        });\r\n        this.doComputation(this.state.grid, this.state.squidsGotten);\r\n    }\r\n\r\n    async incrementKills() {\r\n        this.copyToUndoBuffer();\r\n        let numericValue = this.state.squidsGotten === 'unknown' ? 0 : Number(this.state.squidsGotten);\r\n        let grid = this.state.grid;\r\n        numericValue++;\r\n        if (numericValue === 4) {\r\n            // TODO: Think very carefully about this timer splitting, and if and when it should happen.\r\n            const gameHistoryArguments = this.makeGameHistoryArguments();\r\n            this.splitTimer();\r\n            const success = await this.copyToHistory(gameHistoryArguments);\r\n            if (success) {\r\n                numericValue = 0;\r\n                grid = this.makeEmptyGrid();\r\n                // FIXME: Make us able to undo across completions.\r\n                this.setState({undoBuffer: [], cursorBelief: [3, 3]});\r\n            } else {\r\n                numericValue = 3;\r\n            }\r\n        }\r\n        sendSpywareEvent({kind: 'incrementKills', oldGrid: this.state.grid, newGrid: grid, newNumericValue: numericValue});\r\n        this.setState({grid, squidsGotten: '' + numericValue});\r\n        this.doComputation(grid, '' + numericValue);\r\n    }\r\n\r\n    async copyToHistory(gameHistoryArguments) {\r\n        const {hits} = this.getGridStatistics(this.state.grid, this.state.squidsGotten);\r\n        if (gameHistoryArguments === undefined)\r\n            gameHistoryArguments = this.makeGameHistoryArguments();\r\n        await wasm;\r\n        const finalBoard = disambiguate_final_board(\r\n            Uint8Array.from(hits),\r\n            ...gameHistoryArguments,\r\n        );\r\n        if (finalBoard === undefined) {\r\n            // TODO: Show a proper error message in this case!\r\n            //alert('Ambiguous!');\r\n            sendSpywareEvent({\r\n                kind: 'ambiguousCopyToHistory',\r\n                grid: this.state.grid,\r\n                squidsGotten: this.state.squidsGotten,\r\n                gameHistoryArguments: gameHistoryArguments.map(a => Array.from(a)),\r\n            });\r\n            return false;\r\n        }\r\n        console.log('Final board:', finalBoard);\r\n        sendSpywareEvent({kind: 'copyToHistory', squidLayout: finalBoard});\r\n        const layoutString = this.boardIndexToLayoutString[finalBoard];\r\n        const observedBoards = gameHistoryArguments[0];\r\n        let fillIndex = observedBoards.length;\r\n        // If we're already at capacity then we have to shift the boards over.\r\n        if (fillIndex === this.layoutDrawingBoardRefs.length) {\r\n            this.shiftHistory();\r\n            fillIndex--;\r\n        }\r\n        this.layoutDrawingBoardRefs[fillIndex].current.setStateFromLayoutString(layoutString);\r\n        return true;\r\n    }\r\n\r\n    shiftHistory() {\r\n        sendSpywareEvent({kind: 'shiftHistory'});\r\n        const drawingBoards = this.layoutDrawingBoardRefs.map((ref) => ref.current);\r\n        for (let i = 0; i < drawingBoards.length -1; i++) {\r\n            drawingBoards[i].setState(drawingBoards[i + 1].state);\r\n        }\r\n        drawingBoards[drawingBoards.length - 1].clearBoard();\r\n    }\r\n\r\n    renderActualMap(overlayMode) {\r\n        return <div style={{justifySelf: 'center'}}>\r\n            {naturalsUpTo(8).map(\r\n                (y) => <div key={y} style={{\r\n                    display: 'flex',\r\n                }}>\r\n                    {naturalsUpTo(8).map(\r\n                        (x) => <Tile\r\n                            key={x + ',' + y}\r\n                            x={x} y={y}\r\n                            onClick={() => this.onClick(x, y)}\r\n                            text={this.state.grid[[x, y]]}\r\n                            prob={this.state.probs[[x, y]]}\r\n                            valid={this.state.valid}\r\n                            best={this.state.best}\r\n                            precision={overlayMode ? 0 : 2}\r\n                            opacity={overlayMode ? 0.5 + 0.3 * this.state.probs[[x, y]] : undefined}\r\n                        />\r\n                    )}\r\n                </div>\r\n            )}\r\n        </div>;\r\n    }\r\n\r\n    renderOverlayMap() {\r\n        if (!this.state.doVideoProcessing)\r\n            return;\r\n        return <div style={{\r\n            position: 'absolute',\r\n            top: '210px',\r\n            left: '127px',\r\n            transform: 'scale(1.01, 1.05)',\r\n            zIndex: 20,\r\n            display: 'inline-block',\r\n            /* opacity: 0.4, */\r\n        }}>\r\n            {this.renderActualMap(true)}\r\n        </div>;\r\n    }\r\n\r\n    render() {\r\n        let usedShots = 0;\r\n        let openingOptimizer = true;\r\n        for (let y = 0; y < 8; y++) {\r\n            for (let x = 0; x < 8; x++) {\r\n                if (this.state.grid[[x, y]] !== null) {\r\n                    usedShots++;\r\n                    if (this.state.grid[[x, y]] === 'HIT')\r\n                        openingOptimizer = false;\r\n                }\r\n            }\r\n        }\r\n        return <div style={{\r\n            margin: '20px',\r\n            color: 'white',\r\n        }}>\r\n            <div className=\"container\">\r\n                <div style={{justifySelf: \"end\", alignSelf: \"start\"}}>\r\n                    <div className=\"tableContainer\" style={{gridTemplateColumns: \"repeat(2, 1fr)\"}}>\r\n                        <span><strong>&nbsp;Item&nbsp;</strong></span>\r\n                        <span><strong>&nbsp;Value&nbsp;</strong></span>\r\n                        <span>&nbsp;Shots used:&nbsp;</span>\r\n                        <span>&nbsp;{usedShots}&nbsp;</span>\r\n                        {this.state.turboBlurboMode && this.state.turboBlurboTiming && <>\r\n                            <BoardTimer ref={this.timerRef} roomEnteredOffset={this.state.roomEnteredOffset} timedTickIntercept={this.state.timedTickIntercept} timedTickRate={this.state.timedTickRate}/>\r\n                            <span>&nbsp;Last steps:&nbsp;</span>\r\n                            <span>&nbsp;{this.state.timerStepEstimate === null ? '-' : this.state.timerStepEstimate}&nbsp;</span>\r\n                        </>}\r\n                        {this.state.turboBlurboMode && this.state.turboBlurboTiming && this.state.showKeyShortcuts && <>\r\n                            <span><strong>&nbsp;Control&nbsp;</strong></span><span><strong>&nbsp;Shortcut&nbsp;</strong></span>\r\n                            <span>&nbsp;Toggle Timer&nbsp;</span><span>&nbsp;Space&nbsp;</span>\r\n                            <span>&nbsp;Add Reward&nbsp;</span><span>&nbsp;,&nbsp;</span>\r\n                            <span>&nbsp;Remove Reward&nbsp;</span><span>&nbsp;&lt;&nbsp;</span>\r\n                            <span>&nbsp;Toggle Room Entered&nbsp;</span><span>&nbsp;m&nbsp;</span>\r\n                            <span>&nbsp;Invalidate Timer&nbsp;</span><span>&nbsp;;&nbsp;</span>\r\n                            <span>&nbsp;Reset Timer&nbsp;</span><span>&nbsp;:&nbsp;</span>\r\n                            <span>&nbsp;Split Timer&nbsp;</span><span>&nbsp;s&nbsp;</span>\r\n                        </>}\r\n                    </div>\r\n                    {this.state.turboBlurboMode && this.state.turboBlurboTiming && <>\r\n                        <button style={{ fontSize: '120%', margin: '10px' }} onClick={() => { this.setState({showKeyShortcuts: !this.state.showKeyShortcuts}) }}>Toggle Show Shortcuts</button><br/>\r\n                        <button style={{ fontSize: '120%', margin: '10px' }} onClick={() => { this.setState({spywareMode: !this.state.spywareMode}) }}>{\r\n                            this.state.spywareMode ? <>Disable Spyware Mode</> : <>Enable Spyware Mode</>\r\n                        }</button>\r\n                    </>}\r\n                </div>\r\n                {this.state.doVideoProcessing || this.renderActualMap(false)}\r\n                <span style={{display: \"inline-block\"}}></span>\r\n            </div>\r\n            {this.state.valid || this.state.turboBlurboMode || <div style={{ fontSize: '150%', color: 'white' }}>Invalid configuration! This is not possible.</div>}\r\n            <br />\r\n            <div style={{ fontSize: '150%' }}>\r\n                <span style={{ color: 'white' }}>Number of squids killed:</span>\r\n                <select\r\n                    style={{ marginLeft: '20px', fontSize: '100%' }}\r\n                    value={this.state.squidsGotten}\r\n                    onChange={(event) => {\r\n                        this.setState({ squidsGotten: event.target.value });\r\n                        this.doComputation(this.state.grid, event.target.value);\r\n                    }}\r\n                >\r\n                    {/* In turbo blurbo mode don't allow unknown, because it's just an accident waiting to happen for a runner. */}\r\n                    {\r\n                        this.state.turboBlurboMode ||\r\n                        <option value=\"unknown\">Unknown</option>\r\n                    }\r\n                    <option value=\"0\">0</option>\r\n                    <option value=\"1\">1</option>\r\n                    <option value=\"2\">2</option>\r\n                    <option value=\"3\">3</option>\r\n                </select>\r\n                <br />\r\n                {/*\r\n                <span style={{color: 'white', fontSize: '80%'}}>\r\n                    Probability of this pattern yielding these results: {(100 * this.state.observationProb).toFixed(2) + '%'}\r\n                </span>\r\n                */}\r\n            </div>\r\n            <br/>\r\n            {\r\n                this.state.turboBlurboMode &&\r\n                <>\r\n                    <button style={{ fontSize: '150%', margin: '10px' }} onClick={() => { this.reportMiss(); }}>Miss (z)</button>\r\n                    <button style={{ fontSize: '150%', margin: '10px' }} onClick={() => { this.reportHit(); }}>Hit (x)</button>\r\n                    <button style={{ fontSize: '150%', margin: '10px' }} onClick={() => { this.copyToHistory(); }}>Copy to History (h)</button>\r\n                    <button style={{ fontSize: '150%', margin: '10px' }} onClick={() => { this.shiftHistory(); }}>Shift History</button>\r\n                </>\r\n            }\r\n            <button style={{ fontSize: '150%', margin: '10px' }} onClick={() => { this.incrementKills(); }}>Increment Kills (c)</button>\r\n            <button style={{ fontSize: '150%', margin: '10px' }} onClick={() => { this.clearField(); }}>Reset</button>\r\n            {\r\n                this.state.turboBlurboMode ||\r\n                <select\r\n                    style={{ marginLeft: '20px', fontSize: '150%' }}\r\n                    value={this.state.mode}\r\n                    onChange={(event) => this.setState({ mode: event.target.value })}\r\n                >\r\n                    <option value=\"calculator\">Calculator Mode</option>\r\n                    <option value=\"practice\">Practice Mode</option>\r\n                </select>\r\n            }\r\n            {\r\n                this.state.turboBlurboMode &&\r\n                <div style={{display: 'inline-block', margin: '10px', border: '1px solid white', borderRadius: '5px', fontSize: '130%', padding: '5px'}}>\r\n                    <span style={{margin: '5px'}}>Timer mode:</span>\r\n                    <input\r\n                        type=\"checkbox\"\r\n                        checked={this.state.turboBlurboTiming}\r\n                        onChange={(event) => this.setState({ turboBlurboTiming: !this.state.turboBlurboTiming })}\r\n                        style={{\r\n                            margin: '10px',\r\n                            transform: 'scale(2)',\r\n                        }}\r\n                    />\r\n                </div>\r\n            }\r\n            <br />\r\n            {openingOptimizer && this.state.mode === 'calculator' && (!this.state.turboBlurboMode) && <>\r\n                <div style={{ color: 'white', fontSize: '120%', marginTop: '20px' }}>\r\n                    Opening optimizer: Probability that this<br />pattern would get at least one hit: {\r\n                        this.state.valid ? ((100 * Math.max(0, 1 - this.state.observationProb)).toFixed(2) + '%') : \"Invalid\"\r\n                    }\r\n                </div>\r\n            </>}\r\n            <br/>\r\n            {this.state.turboBlurboMode === 'initializing' && <div style={{ fontSize: '150%', color: 'white' }}>Downloading table...<br/></div>}\r\n            {this.state.turboBlurboMode === true && <>\r\n                <div>\r\n                    {this.layoutDrawingBoardRefs.map((ref, i) =>\r\n                        <LayoutDrawingBoard parent={this} ref={ref} key={i}/>\r\n                    )}\r\n                </div>\r\n                <hr/>\r\n                <div style={{display:\"grid\", gridTemplateColumns: \"1fr auto 1fr\"}}>\r\n                    <div style={{display:\"grid\", gridTemplateRows: \"1fr 1fr 1fr\", gridTemplateColumns: \"repeat(8, 1fr)\", justifyItems: \"center\", alignItems: \"true\", gridColumn: \"2\"}}>\r\n                        <div style={{gridRow: \"1\", gridColumn: \"1 / span 8\"}}>Gaussian RNG step count beliefs (all counts in <i>thousands</i> of steps, except \"Room entered offset\"):</div>\r\n                        <div style={{gridRow: \"2\", gridColumn: \"1\"}}>First board mean:     </div><input style={{width: '60px', fontSize: '120%', gridRow: \"2\", gridColumn: \"2\"}} value={this.state.firstBoardStepsThousands}       onChange={event => this.setState({firstBoardStepsThousands: event.target.value})}/>\r\n                        <div style={{gridRow: \"2\", gridColumn: \"3\"}}>First board stddev:   </div><input style={{width: '60px', fontSize: '120%', gridRow: \"2\", gridColumn: \"4\"}} value={this.state.firstBoardStepsThousandsStdDev} onChange={event => this.setState({firstBoardStepsThousandsStdDev: event.target.value})}/> \r\n                        <div style={{gridRow: \"2\", gridColumn: \"5\"}}>Next board mean:      </div><input style={{width: '60px', fontSize: '120%', gridRow: \"2\", gridColumn: \"6\"}} value={this.state.nextBoardStepsThousands}        onChange={event => this.setState({nextBoardStepsThousands: event.target.value})}/>\r\n                        <div style={{gridRow: \"2\", gridColumn: \"7\"}}>Next board stddev:    </div><input style={{width: '60px', fontSize: '120%', gridRow: \"2\", gridColumn: \"8\"}} value={this.state.nextBoardStepsThousandsStdDev}  onChange={event => this.setState({nextBoardStepsThousandsStdDev: event.target.value})}/>\r\n                        <div style={{gridRow: \"3\", gridColumn: \"1\"}}>Timed board stddev:   </div><input style={{width: '60px', fontSize: '120%', gridRow: \"3\", gridColumn: \"2\"}} value={this.state.timedBoardStepsThousandsStdDev} onChange={event => this.setState({timedBoardStepsThousandsStdDev: event.target.value})}/>\r\n                        <div style={{gridRow: \"3\", gridColumn: \"3\"}}>Timed Tick Intercept: </div><input style={{width: '60px', fontSize: '120%', gridRow: \"3\", gridColumn: \"4\"}} value={this.state.timedTickIntercept}             onChange={event => this.setState({timedTickIntercept: event.target.value})}/>\r\n                        <div style={{gridRow: \"3\", gridColumn: \"5\"}}>Timed Tick Rate:      </div><input style={{width: '60px', fontSize: '120%', gridRow: \"3\", gridColumn: \"6\"}} value={this.state.timedTickRate}                  onChange={event => this.setState({timedTickRate: event.target.value})}/>\r\n                        <div style={{gridRow: \"3\", gridColumn: \"7\"}}>Room entered offset:  </div><input style={{width: '60px', fontSize: '120%', gridRow: \"3\", gridColumn: \"8\"}} value={this.state.roomEnteredOffset}              onChange={event => this.setState({roomEnteredOffset: event.target.value})}/>\r\n                    </div>\r\n                </div>\r\n\r\n                <button style={{ fontSize: '150%', margin: '10px' }} onClick={() => { this.saveConfigParams(); }}>Save Settings</button> &nbsp;\r\n                <button style={{ fontSize: '150%', margin: '10px' }} onClick={() => { this.factoryResetConfigParams(); }}>Reset to Defaults</button>\r\n                <br/>\r\n\r\n                <div style={{margin: '20px', color: 'white', fontSize: '130%', border: '2px solid white', borderRadius: '8px', width: '400px', minHeight: '20px', display: 'inline-block'}}>\r\n                    {this.state.potentialMatches.map((match, i) => {\r\n                        if (match[0] === null) {\r\n                            return <div key={0}>No Matches Found!</div>\r\n                        }\r\n                        else {\r\n                            const diffs = match.slice(1);\r\n                            return <div key={i}>\r\n                                Potential match: {match[0]}{diffs.map((x, i) => <> +{x - match[i]}</>)}\r\n                            </div>;\r\n                        }\r\n                    })}\r\n                </div><br/>\r\n                <button style={{ fontSize: '150%', margin: '10px' }} onClick={() => { this.recomputePotentialMatches(); }}>Find Match Indices</button>\r\n                <div style={{ fontSize: '150%', color: 'white' }}>Turbo blurbo mode initialized.<br/></div>\r\n            </>}\r\n            <button disabled={this.state.turboBlurboMode !== false} style={{ fontSize: '150%', margin: '10px' }} onClick={() => {\r\n                this.initializeTurboBlurboMode(false);\r\n            }}>Initialize Turbo Blurbo Mode</button><br/>\r\n            <button disabled={this.state.turboBlurboMode !== false} style={{ fontSize: '150%', margin: '10px' }} onClick={() => {\r\n                this.initializeTurboBlurboMode(true);\r\n            }}>Initialize Turbo Blurbo Mode (big table)</button><br/>\r\n\r\n            {this.state.spywareMode && <><SpywareModeConfiguration /><br/></>}\r\n\r\n            <span style={{color: 'white'}}>Last recompute time: {this.state.lastComputationTime.toFixed(2)}ms</span>\r\n            <div style={{display: 'none'}} ref={this.hiddenAreaRef}></div>\r\n        </div>;\r\n    }\r\n}\r\n\r\nfunction globalShortcutsHandler(evt) {\r\n    // Check if the target is an input field that should take precedence over shortcuts.\r\n    if (evt.target && 'getAttribute' in evt.target && evt.target.getAttribute('data-stop-shortcuts'))\r\n        return;\r\n\r\n    // Add z or y for German keyboard support.\r\n    var event_key = evt.key.toLowerCase();\r\n    if (event_key === 'z' && evt.ctrlKey)\r\n        globalMap.undoLastMarking();\r\n    else if ((event_key === 'z' || event_key === 'y')  && globalMap !== null)\r\n        globalMap.reportMiss();\r\n    if ((event_key.lower === 'x') && globalMap !== null)\r\n        globalMap.reportHit();\r\n    if (event_key === 'c' && globalMap !== null)\r\n        globalMap.incrementKills();\r\n    if (event_key === 's' && globalMap !== null)\r\n        globalMap.splitTimer();\r\n    if (event_key === 'h' && globalMap !== null)\r\n        globalMap.copyToHistory();\r\n\r\n    if (event_key === ' ' && globalBoardTimer !== null) {\r\n        globalBoardTimer.toggleRunning();\r\n        evt.preventDefault();\r\n    }\r\n    if (event_key === ',' && globalBoardTimer !== null)\r\n        globalBoardTimer.adjustRewards(+1);\r\n    if (event_key === '<' && globalBoardTimer !== null)\r\n        globalBoardTimer.adjustRewards(-1);\r\n    if (event_key === 'm' && globalBoardTimer !== null)\r\n        globalBoardTimer.toggleLoadingTheRoom();\r\n    if (event_key === ';' && globalBoardTimer !== null)\r\n        globalBoardTimer.toggleInvalidated();\r\n    if (event_key === ':' && globalBoardTimer !== null)\r\n        globalBoardTimer.resetTimer();\r\n}\r\n\r\ndocument.addEventListener('keydown', globalShortcutsHandler);\r\n\r\nclass App extends React.Component {\r\n    componentDidMount() {\r\n        document.body.style.backgroundColor = '#666';\r\n    }\r\n\r\n    render() {\r\n        return <div style={{\r\n            textAlign: 'center',\r\n        }}>\r\n            <div style={{ display: 'inline-block', width: '600px' }}>\r\n                <h1 style={{ color: 'white' }}>Sploosh Kaboom Probability Calculator</h1>\r\n                <p style={{ color: 'white' }}>\r\n                    This is a tool for computing the likely locations of squids in the sploosh kaboom minigame of The Legend of Zelda: The Wind Waker (both SD and HD versions).\r\n                    Unfortunately it's currently pretty complicated to use correctly.\r\n                    A collection of tutorials will be compiled at some point, hopefully soon.\r\n                    For now, see the <a href=\"https://github.com/petersn/web-sploosh-kaboom\">GitHub repository</a>.\r\n                </p>\r\n            </div>\r\n            <MainMap />\r\n            <span style={{ color: 'white' }}>Made by Peter Schmidt-Nielsen, CryZe and csunday95 ({VERSION_STRING})</span><br/>\r\n            <span style={{ color: 'white' }}></span>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then(registration => {\r\n        registration.unregister();\r\n      })\r\n      .catch(error => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}